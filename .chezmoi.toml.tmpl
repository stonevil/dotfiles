{{- /*
	vim:ft=toml.gotexttmpl
*/ -}}

# Detect desktop OR laptop. And OS theme
{{ $chassisType := "desktop" }}
{{ if eq .chezmoi.os "darwin" }}
	{{ if contains "Yes" (output  "/usr/sbin/ioreg" "-c" "AppleSmartBattery" "-r" "|" "awk" "'/built-in/" "{print $3}'") }}
		{{ $chassisType := "laptop" }}
	{{ else }}
		{{ $chassisType := "desktop" }}
	{{ end }}
{{ else if eq .chezmoi.os "linux" }}
	{{ if lookPath "hostnamectl" }}
		{{ if contains "systemd" (output "ps" "-aux") }}
			{{ $chassisType := (output "hostnamectl" "--json=short" | mustFromJson).Chassis }}
		{{ else }}
			{{ $chassisType := "desktop" }}
		{{ end }}
	{{ else }}
		{{ $chassisType := "desktop" }}
	{{ end }}
{{ end }}

# Predefine basic variables
{{ $bg := "000000" }}

# Ask questin about environment
{{ $ownership := "private" }}{{ if hasKey . "ownership" }}{{ $ownership = .ownership }}{{ end }}
{{ $ownership = (promptStringOnce . "Ownership" "Private or company property. Use company name for working computer" $ownership) | quote }}

{{ $uname := "fubar" }}{{ if hasKey . "uname" }}{{ $uname = .uname }}{{ end }}
{{ $uname = (promptStringOnce . "Full Name" "What is your full name" $uname) | quote }}

{{ $email := "fu@bar.org" }}{{ if hasKey . "email" }}{{ $email = .email }}{{ end }}
{{ $email = (promptStringOnce . "email" "What is your email address" $email) | quote }}

{{ $themeDarkMode := true }}{{ if hasKey . "theme" }}{{ if hasKey .theme "themeDarkMode" }}{{ $themeDarkMode = .theme.themeDarkMode }}{{ end }}{{ end }}
{{ $themeDarkMode = promptBool "Are you prefer Dark Mode" $themeDarkMode }}

{{ $themeName := "catppuccin" }}{{ if hasKey . "theme" }}{{ if hasKey .theme "themeName" }}{{ $themeName = .theme.themeName }}{{ end }}{{ end }}
{{ $themeName = promptChoice "Choose Theme" (list "catppuccin") $themeName }}

{{ $themeVariant := "mocha" }}{{ if hasKey . "theme" }}{{ if hasKey .theme "themeVariant" }}{{ $themeVariant = .theme.themeVariant }}{{ end }}{{ end }}
{{ if eq $themeName "catppuccin" }}
	{{ if $themeDarkMode }}
		{{ $themeVariant = promptChoice "Theme Variant" (list "mocha" "macchiato" "frappe") $themeVariant }}
	{{ else }}
		{{ $themeVariant = "latte" }}
	{{ end }}
{{ end }}

{{ $neovimCli := false }}
{{ $terminalMultiplexer := false }}
{{ $devToolsCli := false }}
{{ $dbToolsCli := false }}
{{ $vagrantCli := false }}
{{ $hashiCli := false }}
{{ $limaCli := false }}
{{ $k8sToolsCli := false }}
{{ $ansibleCli := false }}
{{ $espToolsCli := false }}
{{ $utilsCli := false }}
{{ $networkToolsCli := false }}
{{ $syncTools := false }}
{{ $mailCli := false }}
{{ $mediaToolsCli := false }}
{{ $newsCli := false }}
{{ $dekCli := false }}
{{ $adsToolsCli := false }}
{{ $gamesCli := false }}
{{ $fwupdCli := false }}
{{ $zephyrus := false }}
{{ $nvidia := false }}
{{ $thinkpad := false }}
{{ $xfce := false }}
{{ $plasma := false }}
{{ $hyprland := false }}
{{ $browsers := false }}
{{ $terminalEmulators := false }}
{{ $devTools := false }}
{{ $dbTools := false }}
{{ $messengers := false }}
{{ $mail := false }}
{{ $books := false }}
{{ $media := false }}
{{ $modeling := false }}
{{ $graphics := false }}
{{ $schematics := false }}
{{ $networkTools := false }}
{{ $virt := false }}
{{ $tor := false }}
{{ $torrent := false }}
{{ $utils := false }}

{{ if hasKey . "tags" }}
	{{ if hasKey .tags "neovimCli" }}{{ $neovimCli = .tags.neovimCli.enabled }}{{ end }}
	{{ if hasKey .tags "terminalMultiplexer" }}{{ $terminalMultiplexer = .tags.terminalMultiplexer.enabled }}{{ end }}
	{{ if hasKey .tags "devToolsCli" }}{{ $devToolsCli = .tags.devToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "dbToolsCli" }}{{ $dbToolsCli = .tags.dbToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "vagrantCli" }}{{ $vagrantCli = .tags.vagrantCli.enabled }}{{ end }}
	{{ if hasKey .tags "hashiCli" }}{{ $hashiCli = .tags.hashiCli.enabled }}{{ end }}
	{{ if hasKey .tags "limaCli" }}{{ $limaCli = .tags.limaCli.enabled }}{{ end }}
	{{ if hasKey .tags "k8sToolsCli" }}{{ $k8sToolsCli = .tags.k8sToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "ansibleCli" }}{{ $ansibleCli = .tags.ansibleCli.enabled }}{{ end }}
	{{ if hasKey .tags "espToolsCli" }}{{ $espToolsCli = .tags.espToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "utilsCli" }}{{ $utilsCli = .tags.utilsCli.enabled }}{{ end }}
	{{ if hasKey .tags "networkToolsCli" }}{{ $networkToolsCli = .tags.networkToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "syncTools" }}{{ $syncTools = .tags.syncTools.enabled }}{{ end }}
	{{ if hasKey .tags "mailCli" }}{{ $mailCli = .tags.mailCli.enabled }}{{ end }}
	{{ if hasKey .tags "mediaToolsCli" }}{{ $mediaToolsCli = .tags.mediaToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "newsCli" }}{{ $newsCli = .tags.newsCli.enabled }}{{ end }}
	{{ if hasKey .tags "dekCli" }}{{ $dekCli = .tags.dekCli.enabled }}{{ end }}
	{{ if hasKey .tags "adsToolsCli" }}{{ $adsToolsCli = .tags.adsToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "gamesCli" }}{{ $gamesCli = .tags.gamesCli.enabled }}{{ end }}
	{{ if hasKey .tags "fwupdCli" }}{{ $fwupdCli = .tags.fwupdCli.enabled }}{{ end }}
	{{ if hasKey .tags "zephyrus" }}{{ $zephyrus = .tags.zephyrus.enabled }}{{ end }}
	{{ if hasKey .tags "nvidia" }}{{ $nvidia = .tags.nvidia.enabled }}{{ end }}
	{{ if hasKey .tags "thinkpad" }}{{ $thinkpad = .tags.thinkpad.enabled }}{{ end }}
	{{ if hasKey .tags "xfce" }}{{ $xfce = .tags.xfce.enabled }}{{ end }}
	{{ if hasKey .tags "plasma" }}{{ $plasma = .tags.plasma.enabled }}{{ end }}
	{{ if hasKey .tags "hyprland" }}{{ $hyprland = .tags.hyprland.enabled }}{{ end }}
	{{ if hasKey .tags "browsers" }}{{ $browsers = .tags.browsers.enabled }}{{ end }}
	{{ if hasKey .tags "terminalEmulators" }}{{ $terminalEmulators = .tags.terminalEmulators.enabled }}{{ end }}
	{{ if hasKey .tags "devTools" }}{{ $devTools = .tags.devTools.enabled }}{{ end }}
	{{ if hasKey .tags "dbTools" }}{{ $dbTools = .tags.dbTools.enabled }}{{ end }}
	{{ if hasKey .tags "messengers" }}{{ $messengers = .tags.messengers.enabled }}{{ end }}
	{{ if hasKey .tags "mail" }}{{ $mail = .tags.mail.enabled }}{{ end }}
	{{ if hasKey .tags "books" }}{{ $books = .tags.books.enabled }}{{ end }}
	{{ if hasKey .tags "media" }}{{ $media = .tags.media.enabled }}{{ end }}
	{{ if hasKey .tags "modeling" }}{{ $modeling = .tags.modeling.enabled }}{{ end }}
	{{ if hasKey .tags "graphics" }}{{ $graphics = .tags.graphics.enabled }}{{ end }}
	{{ if hasKey .tags "schematics" }}{{ $schematics = .tags.schematics.enabled }}{{ end }}
	{{ if hasKey .tags "networkTools" }}{{ $networkTools = .tags.networkTools.enabled }}{{ end }}
	{{ if hasKey .tags "virt" }}{{ $virt = .tags.virt.enabled }}{{ end }}
	{{ if hasKey .tags "tor" }}{{ $tor = .tags.tor.enabled }}{{ end }}
	{{ if hasKey .tags "torrent" }}{{ $torrent = .tags.torrent.enabled }}{{ end }}
	{{ if hasKey .tags "utils" }}{{ $utils = .tags.utils.enabled }}{{ end }}
{{ end }}

{{ $neovimCli = promptBool "NeoVIM IDE" $neovimCli }}
{{ $terminalMultiplexer = promptBool "Terminal Mutiplexer, like TMUX" $terminalMultiplexer }}
{{ $devToolsCli = promptBool "DEV CLI tools, like jq, bat" $devToolsCli }}
{{ $dbToolsCli = promptBool "DB management CLI tools, like usql" $dbToolsCli }}
{{ if eq .chezmoi.os "linux" }}
	{{ $vagrantCli = promptBool "HashiCorp Vagrant CLI tools" $vagrantCli }}
{{ end }}
{{ $hashiCli = promptBool "HashiCorp CLI tools" $hashiCli }}
{{ $limaCli = promptBool "Lima-VM CLI tools" $limaCli }}
{{ $k8sToolsCli = promptBool "K8S CLI tools" $k8sToolsCli }}
{{ $ansibleCli = promptBool "Ansible deployemnt and configuration CLI tools" $ansibleCli }}
{{ $espToolsCli = promptBool "ESP DEV tools" $espToolsCli }}
{{ $utilsCli = promptBool "Utils CLI tools, like smartmontools" $utilsCli }}
{{ $networkToolsCli := promptBool "Network CLI tools" $networkToolsCli }}
{{ $syncTools = promptBool "Sync CLI / GUI tools, like Syncthing" $syncTools }}
{{ $mailCli = promptBool "Mail CLI tools, like NeoMutt" $mailCli }}
{{ $mediaToolsCli = promptBool "Media CLI tools, like ffmpeg" $mediaToolsCli }}
{{ $newsCli := promptBool "News CLI tools, like NewsBoat" $newsCli }}
{{ $dekCli := promptBool "TUI presentation tools, like presenterm" $dekCli }}
{{ if eq .chezmoi.os "linux" }}
	{{ $adsToolsCli = promptBool "Ads block CLI tools, like hblock" $adsToolsCli }}
{{ end }}
{{ $gamesCli = promptBool "Some CLI games, like typing tutor" $gamesCli }}

{{ if eq .chezmoi.os "linux" }}
	{{ $fwupdCli = promptBool "Linux hardware firmware updater, fwupd" $fwupdCli }}

	{{ $zephyrus = promptBool "Is this ASUS Zephyrus line laptop" $zephyrus }}
	{{ if $zephyrus }}
		{{ $nvidia = promptBool "Enable Nvidia GPU" $nvidia }}
	{{ end }}
	{{ $thinkpad = promptBool "Is this Lenovo Thinkpad line laptop" $thinkpad }}

	{{ $plasma = promptBool "KDE Plasma DE" $plasma }}
	{{ $hyprland = promptBool "Hyprland DE" $hyprland }}
{{ end }}

# Ask questin about environment if GUI env enabled
{{ if or (or ($plasma) ($hyprland)) (eq .chezmoi.os "darwin") }}
	{{ $browsers = promptBool "Web browsers, like LibreWolf" $browsers }}
	{{ $terminalEmulators = promptBool "GUI Terminal Emulators, like WezTerm" $terminalEmulators }}
	{{ $devTools = promptBool "DEV apps, like CotEditor" $devTools }}
	{{ $dbTools = promptBool "DB management tools, like DBeaver" $dbTools }}
	{{ $messengers = promptBool "Messengers apps, like Discord" $messengers }}
	{{ $mail = promptBool "Mail apps, like Thunderbird" $mail }}
	{{ $books = promptBool "Book management apps, like Calibre" $books }}
	{{ $media = promptBool "Media apps, like mpv, kid3" $media }}
	{{ $modeling = promptBool "3D modeling apps, like Blender, FreeCAD" $modeling }}
	{{ $graphics = promptBool "Graphics apps, Gimp, Krita" $graphics }}
	{{ $schematics = promptBool "Electronics and PCB design apps, like KiCad" $schematics }}
	{{ $networkTools = promptBool "Network apps, like VNC/RDP clients" $networkTools }}
	{{ $virt = promptBool "Virtualisation apps, like UTM for macOS" $virt }}
	{{ $tor = promptBool "Tor network apps, like Tor Browser for macOS" $tor }}
	{{ $torrent = promptBool "Torrent network apps, like qBittorrent" $torrent }}
	{{ $utils = promptBool "Utils apps, like OnyX for macOS" $utils }}
{{ end }}

{{ $tabs := 2 }}
{{ $shellPath := "/bin/zsh" }}
{{ $opacity := (int64 1.0) }}

{{ if hasKey . "terminal" }}
	{{ if hasKey .terminal "tabs" }}{{ $tabs = int64 .terminal.tabs }}{{ end }}
	{{ if hasKey .terminal "shellPath" }}{{ $shellPath = .terminal.shellPath }}{{ end }}
	{{ if hasKey .terminal "opacity" }}{{ $opacity = (int64 .terminal.opacity) }}{{ end }}
{{ end }}

{{ $tabs = promptInt "WARNING: default tabs width" (int64 $tabs) }}
{{ $shellPath = (promptString "WARNING: path to shell. Path should be absolute path to the already installed shell!" $shellPath) | quote }}
{{ $opacity = (int64 (promptString "WARNING: windows opacity, choose between 0.1 and 1.0" ($opacity | toString))) }}

# Set user information
[data]
	email = {{ $email }}
	uname = {{ $uname }}
	ownership = {{ $ownership }}

# Define environment tags, packages, dependencies, etc.
[data.tags.core]
	enabled = true
	darwin = [
		"diffutils",
		"dos2unix",
		"git",
		"gawk",
		"gnu-sed",
		"gnu-tar",
		"gzip",
		"less",
		"star",
		"screen",
		"telnet",
		"tree",
		"unzip",
		"watch",
		"wget",
	]
	arch = [
		"yay",
		"bash",
		"bash-completion",
		"zsh",
		"extra/zsh-completions",
		"less",
		"man-db",
		"cpio",
		"dos2unix",
		"diffutils",
		"curl",
		"git",
		"inetutils",
		"less",
		"tree",
		"screen",
		"tar",
		"unzip",
		"wget",
		"which",
		"glibc-locales",
		"networkmanager",
	]
	fedora = [
		"bash",
		"bash-completion",
		"zsh",
		"less",
		"man-db",
		"cpio",
		"dos2unix",
		"diffutils",
		"curl",
		"git",
		"cracklib",
		"cracklib-dicts",
		"tree",
		"screen",
		"tar",
		"unzip",
		"wget",
		"which",
		"glibc-common",
	]
	pre.fedora = [
		"rpmfusion_add",
	]
	upgrade.darwin = [
		"yu",
		"yc",
	]
	upgrade.arch = [
		"yu",
		"yc",
	]
	upgrade.fedora = [
		"yu",
		"yc",
	]

[data.tags.python3]
	enabled = {{ if or ($neovimCli) ($devToolsCli) ($espToolsCli) ($mediaToolsCli) ($ansibleCli) }} true {{ else }} false {{ end }}
	darwin = [
		"python3",
		"uv",
	]
	arch = [
		"python",
		"python-pip",
		"uv",
	]
	uv = [
		"wheel==0.45.0",
	]
	pre.darwin = [
		"darwin_python3_library_lock",
	]
	post.darwin = [
		"brew unlink --quiet python3; brew link --overwrite --force --quiet python3",
		"brew_python3_relink",
	]
	upgrade.darwin = [
		"brew_python3_relink",
		"uv_upgrade",
	]
	cleanup.darwin = [
		"brew_python3_unlink",
	]
	upgrade.arch = [
		"uv_upgrade",
	]

[data.tags.go]
	enabled = {{ if or ($neovimCli) ($gamesCli) }} true {{ else }} false {{ end }}
	darwin = [
		"go",
		"delve",
		"golangci-lint",
	]
	arch = [
		"go",
		"delve",
		"golangci-lint",
	]

[data.tags.rust]
	enabled = {{ if or ($neovimCli) ($utilsCli) }} true {{ else }} false {{ end }}
	darwin = [
		"rust",
		"cargo-binstall",
		"cargo-update",
	]
	arch = [
		"rust",
		"cargo-binstall",
		"cargo-update",
	]

[data.tags.nodejs]
	enabled = {{ if or ($neovimCli) ($devToolsCli) }} true {{ else }} false {{ end }}
	darwin = [
		"node",
	]
	arch = [
		"nodejs",
		"npm",
	]
	npm = [
		"yarn",
	]
	post.darwin = [
		"npm_update_self || true",
	]
	upgrade.darwin = [
		"npm_update_self || true",
		"npm_update || true",
	]
	upgrade.arch = [
		"npm_update || true",
	]

[data.tags.lua]
	enabled = {{ if ($neovimCli) }} true {{ else }} false {{ end }}
	darwin = [
		"lua",
		"luajit",
		"luarocks",
	]
	arch = [
		"lua51",
		"lua",
		"luajit",
		"luarocks",
	]

[data.tags.ruby]
	enabled = {{ if $neovimCli }} true {{ else }} false {{ end }}
	arch = [
		"ruby",
	]

[data.tags.gitCli]
	enabled = {{ if or ($neovimCli) ($devToolsCli) ($terminalMultiplexer) }} true {{ else }} false {{ end }}
	darwin = [
		"git",
		"git-lfs",
		"hub",
		"lazygit",
	]
	arch = [
		"git",
		"git-lfs",
		"hub",
		"lazygit",
	]

[data.tags.terminalMultiplexer]
	enabled = {{ $terminalMultiplexer }}
	darwin = [
		"tmux",
	]
	arch = [
		"tmux",
	]
	upgrade.darwin = [
		"tmux_plugins_update",
	]
	upgrade.arch = [
		"tmux_plugins_update",
	]
	upgrade.fedora = [
		"tmux_plugins_update",
	]

[data.tags.utilsCli]
	enabled = {{ $utilsCli }}
	darwin = [
		"parallel",
		"smartmontools",
		"dmg2img",
		"dua-cli",
	]
	arch = [
		"parallel",
		"dua-cli",
	]
	cargo = [
		"battop",
	]

[data.tags.devToolsCli]
	enabled = {{ if or ($devToolsCli) ($neovimCli) }} true {{ else }} false {{ end }}
	darwin = [
		"ccache",
		"ccat",
		"gcc",
		"makedepend",
		"mkcert",
		"mkdocs",
		"eslint",
		"ninja",
		"the_silver_searcher",
		"ripgrep",
		"universal-ctags",
		"source-highlight",
		"bat",
		"jq",
		"stylua",
		"git-delta",
		"curlie",
		"ast-grep",
		"shellcheck",
		"marksman",
	]
	arch = [
		"base-devel",
		"ctags",
		"eslint",
		"ninja",
		"source-highlight",
		"the_silver_searcher",
		"ripgrep",
		"httpie",
		"bat",
		"jq",
		"stylua",
		"git-delta",
		"curlie",
		"ast-grep",
		"shellcheck",
		"marksman",
	]
	uv = [
		"httpie",
		"posting",
	]
	npm = [
		"@mermaid-js/mermaid-cli",
	]
	upgrade.darwin = [
		"bat_cache_update",
	]
	upgrade.arch = [
		"bat_cache_update",
	]
	upgrade.fedora = [
		"bat_cache_update",
	]

[data.tags.dbToolsCli]
	enabled = {{ $dbToolsCli }}
	darwin = [
		"xo/xo/usql",
	]
	arch = [
		"usql-bin",
	]

[data.tags.k8sToolsCli]
	enabled = {{ $k8sToolsCli }}
	darwin = [
		"kubectl",
		"krew",
		"k9s",
		"stern",
		"helm",
	]
	arch = [
		"kubectl",
		"krew",
		"k9s",
		"stern",
		"helm",
	]
	krew = [
		"ctr",
		"ctx",
		"exec-as",
		"fuzzy",
		"mtail",
		"ns",
		"node-admin",
		"node-restart",
		"node-shell",
		"restart",
		"view-allocations",
		"view-secret",
		"view-utilization",
	]
	upgrade.darwin = [
		"krew_upgrade",
	]
	upgrade.arch = [
		"krew_upgrade",
	]
	upgrade.fedora = [
		"krew_upgrade",
	]

[data.tags.ansibleCli]
	enabled = {{ $ansibleCli }}
	uv = [
		"ansible",
		"ansible-lint",
		"molecule",
		"ansible-navigator",
		"yamllint",
	]

[data.tags.neovimCli]
	enabled = {{ $neovimCli }}
	darwin = [
		"neovim",
		"lua-language-server",
	]
	arch = [
		"neovim",
		"lua-language-server",
	]
	fedora = [
		"neovim",
	]
	uv = [
		"pynvim",
		"flake8",
		"yamllint",
		"ruff",
		"gitlint-core",
	]
	npm = [
		"neovim",
		"cspell",
	]
	rocks = [
		"jsregexp",
		{{ if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "fedora") }}"lua-language-server",{{ end }}
	]
	gem = [
		{{ if eq .chezmoi.os "linux" }}"neovim",{{ end }}
	]
	upgrade.darwin = [
		"nvim_plugins_update",
	]
	upgrade.arch = [
		"nvim_plugins_update",
	]
	upgrade.fedora = [
		"nvim_plugins_update",
	]

[data.tags.limaCli]
	enabled = {{ if ($limaCli) }} true {{ else }} false {{ end }}

[data.tags.virtCli]
	enabled = {{ if ($limaCli) }} true {{ else }} false {{ end }}
	darwin = [
		"qemu",
	]
	arch = [
		"qemu-full",
		"virtiofsd",
	]
	fedora = [
		"qemu",
		"virtiofsd",
	]

[data.tags.fwupdCli]
	enabled = {{ $fwupdCli }}
	arch = [
		"fwupd",
	]
	fedora = [
		"fwupd",
	]
	post.arch = [
		"sudo systemctl enable --now fwupd-refresh.timer",
	]
	upgrade.arch = [
		"fwupd_update",
	]
	post.fedora = [
		"sudo systemctl enable --now fwupd-refresh.timer",
	]
	upgrade.fedora = [
		"fwupd_update",
	]

[data.tags.mediaToolsCli]
	enabled = {{ $mediaToolsCli }}
	darwin = [
		"jpeg",
		"imagemagick",
		"ffmpeg",
	]
	arch = [
		"imagemagick",
		"ffmpeg",
	]
	fedora = [
		"ImageMagick",
	]
	pre.fedora = [
		"sudo dnf swap -y --allowerasing ffmpeg-free ffmpeg",
		"sudo dnf swap -y --allowerasing libavcodec-free libavcodec-freeworld",
	]
	uv = [
		"yt-dlp",
	]

[data.tags.adsToolsCli]
	enabled = {{ $adsToolsCli }}
	arch = [
		"hblock",
	]
	upgrade.arch = [
		"hblock_update",
	]
	remove.arch = [
		"if command -v hblock >/dev/null 2>&1; then hblock --sources none --denylist none; fi",
	]

[data.tags.gamesCli]
	enabled = {{ $gamesCli }}
	darwin = [
		"typioca",
	]
	arch = [
		"typioca-bin",
	]
	go = [
		{{ if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "fedora" ) }}"github.com/bloznelis/typioca@latest",{{ end }}
	]

[data.tags.dekCli]
	enabled = {{ $dekCli }}

[data.tags.newsCli]
	enabled = {{ $newsCli }}
	darwinhead = [
		"stonevil/brew/curl-impersonate",
	]
	darwin = [
		"newsboat",
	]
	arch = [
		"newsboat",
		"curl-impersonate",
	]

[data.tags.mailCli]
	enabled = {{ $mailCli }}
	darwin = [
		"neomutt",
	]
	arch = [
		"neomutt",
	]

[data.tags.networkToolsCli]
	enabled = {{ $networkToolsCli }}
	darwin = [
		"nmap",
	]
	arch = [
		"nmap",
	]

[data.tags.syncTools]
	enabled = {{ if ($syncTools) }} true {{ else }} false {{ end }}
	darwin = [
		"syncthing",
	]
	arch = [
		"syncthing",
	]
	post.darwin = [
		"mkdir -p ${HOME}/Library/LaunchAgents && chflags nouchg ${HOME}/Library/LaunchAgents && brew services start syncthing && chflags uchg ${HOME}/Library/LaunchAgents",
	]
	post.arch = [
		"systemctl --user enable syncthing.service",
	]
	remove.darwin = [
		"mkdir -p ${HOME}/Library/LaunchAgents && chflags nouchg ${HOME}/Library/LaunchAgents && brew services stop syncthing && chflags uchg ${HOME}/Library/LaunchAgents",
	]

[data.tags.hashiCli]
	enabled = {{ $hashiCli }}
	darwin = [
		"terraform",
	]
	arch = [
		"terraform",
	]

[data.tags.vagrantCli]
	enabled = {{ $vagrantCli }}
	arch = [
		"vagrant",
	]
	vagrant = [
		{{- if eq .chezmoi.os "linux" }}
		"vagrant-libvirt",
		"vagrant-vbguest",
		"vagrant-reload",
		{{- end }}
	]
	upgrade.arch = [
		"vagrant_plugins_update",
	]

[data.tags.espToolsCli]
	enabled = {{ $espToolsCli }}
	pre.darwin = [
		"brew_python3_relink",
	]
	upgrade.darwin = [
		"brew_python3_relink",
		"esp_idf_update",
	]
	upgrade.arch = [
		"esp_idf_update",
	]
	remove.darwin = [
		'if [[ -d {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }}; fi; if [[ -d {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }}; fi',
	]
	remove.arch = [
		'if [[ -d {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }}; fi; if [[ -d {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }}; fi',
	]

[data.tags.displayManager]
	enabled = {{ if or ($hyprland) ($plasma) }} true {{ else}} false {{ end }}
	arch = [
		"ly",
		"brightnessctl",
	]
	post.arch = [
		"sudo systemctl enable --now ly@tty2.service",
		"sudo systemctl disable --now getty@tty2.service",
	]

[data.tags.spell]
	enabled = {{ if or ($hyprland) ($plasma) }} true {{ else}} false {{ end }}
	arch = [
		"sonnet",
		"hunspell",
		"hunspell-en_us",
		"hunspell-en_gb",
	]

[data.tags.fontTools]
	enabled = {{ if or ($hyprland) ($plasma) (eq .chezmoi.os "darwin") }} true {{ else}} false {{ end }}
	darwin = [
		"fontconfig",
	]
	arch = [
		"fontconfig",
	]
	upgrade.darwin = [
		"fonts_cache_update",
	]
	upgrade.arch = [
		"fonts_cache_update",
	]

[data.tags.printManager]
	enabled = {{ if or ($hyprland) ($plasma) }} true {{ else}} false {{ end }}
	arch = [
		"print-manager",
		"cups",
		"cups-pdf",
		"system-config-printer",
		"ghostscript",
		"gsfonts",
		"gutenprint",
		"foomatic-db",
		"foomatic-db-engine",
		"foomatic-db-nonfree",
		"foomatic-db-ppds",
		"gutenprint",
		"foomatic-db-gutenprint-ppds",
	]
	upgrade.arch = [
		"sudo cups-genppdupdate",
	]

[data.tags.xfce]
	enabled = {{ $xfce }}
	fedora = [
		"@base-x",
		"xrdp",
		"xorgxrdp",
		"xfconf",
		"xfdesktop",
		"xfwm4",
		"xfce4-session",
		"xfce4-settings",
		"xfce4-panel",
		"xfce4-places-plugin",
		"xfce4-xkb-plugin",
		"xfce4-terminal",
		"thunar",
		"thunar-archive-plugin",
		"materia-gtk-theme",
		"ristretto",
		"mousepad",
	]

[data.tags.hyprland]
	enabled = {{ $hyprland }}
	arch = [
		"hyprland",
		"xdg-desktop-portal-hyprland",
		"xdg-desktop-portal-gtk",
		"nwg-displays",
		"hypridle",
		"hyprlock",
		"hyprcursor",
		"hyprpolkitagent",
		"wl-clipboard",
		"wlr-randr",
		"hyprmon-bin",
	]

[data.tags.plasma]
	enabled = {{ $plasma }}
	arch = [
		"plasma-desktop",
		"kscreen",
		"bluedevil",
		"bluez",
		"bluez-utils",
		"okular",
		"ark",
		"kate",
		"kcalc",
		"dolphin",
		"dolphin-plugins",
		"konsole",
		"kde-gtk-config",
		"xdg-desktop-portal",
		"xdg-desktop-portal-kde",
		"kscreenlocker",
		"plasma-pa",
		"plasma-nm",
		"breeze",
		"breeze-gtk",
		"kpipewire",
		"plasma-disks",
		"plasma-browser-integration",
		"plasma-systemmonitor",
		"plasma-thunderbolt",
		"powerdevil",
		"print-manager",
		"spectacle",
		"partitionmanager",
		"konqueror",
		"marknote",
		"kdialog",
		"extra/qt6-tools",
		"wl-clipboard",
		"kwallet",
		"kwalletmanager",
		"kwallet-pam",
		"ksshaskpass",
	]

[data.tags.browsers]
	enabled = {{ $browsers }}
	darwin = [
		"librewolf",
		"waterfox",
		"ungoogled-chromium",
	]
	arch = [
		"librewolf-bin",
		"waterfox-bin",
		"ungoogled-chromium-bin",
	]
	pre.fedora = [
		"curl -fsSL https://repo.librewolf.net/librewolf.repo | sudo tee /etc/yum.repos.d/librewolf.repo",
	]
	cleanup.fedora = [
		"sudo rm -f /etc/yum.repos.d/librewolf.repo",
	]

[data.tags.networkTools]
	enabled = {{ $networkTools }}
	arch = [
		"krdc",
		"krfb",
	]

[data.tags.devTools]
	enabled = {{ $devTools }}
	darwin = [
		"kdiff3",
		"coteditor",
		"keycastr",
		"kommit",
	]
	arch = [
		"kdiff3",
		"kompare",
		"kommit",
	]

[data.tags.dbTools]
	enabled = {{ $dbTools }}
	darwin = [
		"dbeaver-community",
	]
	arch = [
		"dbeaver",
	]

[data.tags.messengers]
	enabled = {{ $messengers }}
	darwin = [
		"discord",
	]
	arch = [
		"discord",
	]

[data.tags.mail]
	enabled = {{ $mail }}
	darwin = [
		"thunderbird",
	]
	arch = [
		"thunderbird",
		"thunderbird-i18n-uk",
		"thunderbird-dark-reader",
		"thunderbird-ublock-origin",
	]

[data.tags.media]
	enabled = {{ $media }}
	darwin = [
		"stonevil/brew/mpv",
		"kid3",
		"xact",
		"handbrake",
	]
	arch = [
		"mpv",
		"kid3",
		"handbrake",
	]
	fedora = [
		"mpv",
	]

[data.tags.books]
	enabled = {{ $books }}
	darwin = [
		"calibre",
	]
	arch = [
		"calibre",
	]

[data.tags.virt]
	enabled = {{ $virt }}
	darwin = [
		"utm",
	]
	arch = [
		"karton",
		"virt-manager",
	]
	post.arch = [
		"sudo usermod -a -G libvirt-qemu ${USER}",
		"sudo systemctl enable --now libvirtd.service",
		"sudo systemctl enable --now libvirtd.socket",
	]

[data.tags.tor]
	enabled = {{ $tor }}
	darwin = [
		"tor-browser",
	]
	arch = [
		"torbrowser-launcher",
	]

[data.tags.torrent]
	enabled = {{ $torrent }}
	darwin = [
		"stonevil/brew/qbittorrent",
	]
	arch = [
		"qbittorrent",
	]
	fedora = [
		"qbittorrent",
	]

[data.tags.utils]
	enabled = {{ $tor }}
	darwin = [
		"keepingyouawake",
		"coconutbattery",
		"onyx",
		"homebrew/cask/sloth",
	]
	arch = [
		"kdiskmark",
	]

[data.tags.terminalEmulators]
	enabled = {{ $terminalEmulators }}
	darwin = [
		"timg",
		"wezterm",
	]
	arch = [
		"timg",
		"foot",
		"foot-terminfo",
		"wezterm",
	]

[data.tags.modeling]
	enabled = {{ $modeling }}
	darwin = [
		"freecad",
		"blender",
		"handbrake",
	]
	arch = [
		"freecad",
		"blender",
		"handbrake",
	]

[data.tags.graphics]
	enabled = {{ $graphics }}
	darwin = [
		"imageoptim",
		"krita",
		"gimp",
		"inkscape",
	]
	arch = [
		"optiimage",
		"krita",
		"gimp",
		"inkscape",
	]

[data.tags.schematics]
	enabled = {{ $schematics }}
	darwin = [
		"kicad",
	]
	arch = [
		"kicad",
		"kicad-library",
		"kicad-library-3d",
		"python-kikit",
		"python-pcbnewtransition",
		"openboardview",
	]
	fedora = [
		"kicad",
		"kicad-doc",
		"kicad-packages3d",
	]

[data.tags.laptop]
	enabled = {{ if or ($zephyrus) ($thinkpad) }}true{{ else }}false{{ end }}
	arch = [
		"bolt",
		"nvme-cli",
		"powerstat",
		"upower",
		"intel-ucode",
		"intel-media-driver",
		"intel-gpu-tools",
		"smartmontools",
		"linux-firmware-intel",
		"libva-intel-driver-irql",
	]

[data.tags.nvidia]
	enabled = {{ $nvidia }}
	arch = [
		"nvidia-open-dkms",
		"nvidia-utils",
		"libva-nvidia-driver",
	]
	pre.arch = [
		"cd /tmp && rm -rf /tmp/nvidia-laptop-power-cfg && git clone https://gitlab.com/asus-linux/nvidia-laptop-power-cfg.git && cd nvidia-laptop-power-cfg && makepkg --noconfirm --cleanbuild --syncdeps --force --install && cd /tmp && rm -rf /tmp/nvidia-laptop-power-cfg",
		"sudo systemctl enable nvidia-suspend.service nvidia-hibernate.service nvidia-resume.service",
		"sudo systemctl enable --now nvidia-powerd",
	]

# TODO: add more sophisticated hardware detection
# Hardware specific configs
[data.tags.zephyrus]
	enabled = {{ $zephyrus }}
	arch = [
		"asusctl",
		{{if $nvidia }}"supergfxctl",{{ end }}
		"bat-asus-battery-bin",
		"rog-control-center",
		"linux-g14",
		"linux-g14-headers",
		"power-profiles-daemon",
		"aic94xx-firmware",
		"ast-firmware",
		"upd72020x-fw",
		"linux-firmware-qlogic",
		"wd719x-firmware",
		"sof-firmware",
	]
	pre.arch = [
		"cd /tmp && wget 'https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x8b15a6b0e9a3fa35' -O g14.sec",
		"sudo pacman-key -a /tmp/g14.sec",
		"sudo pacman-key --recv-keys 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"sudo pacman-key --finger 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"sudo pacman-key --lsign-key 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"sudo pacman-key --finger 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"grep -qF '[g14]' /etc/pacman.conf || echo -e '\n[g14]\nServer = https://arch.asus-linux.org' | sudo tee -a /etc/pacman.conf >/dev/null",
	]
	post.arch = [
		"sudo systemctl enable --now power-profiles-daemon",
		{{- if $nvidia }}
		"sudo systemctl enable --now supergfxd",
		"echo -e '[Unit]\nDescription=Restart supergfxd upon resume to re-suspend the dGPU\nAfter=suspend.target\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/systemctl --no-block restart supergfxd\n\n[Install]\nWantedBy=suspend.target' | sudo tee /etc/systemd/system/supergfxd-restart-after-wakeup.service >/dev/null",
		"sudo systemctl daemon-reload",
		"sudo systemctl enable --now supergfxd-restart-after-wakeup.service",
		{{- end }}
	]

[data.tags.thinkpad]
	enabled = {{ $thinkpad }}
	arch = [
		"sof-firmware",
		"easyeffects",
	]


# Define terminal env like tabs width, transparency, etc.
[data.terminal]
	fontsList = ["FiraCode", "Iosevka", "Monoid", "ProggyClean", "RobotoMono",]
	font = "Iosevka Nerd Font"
	fontNormal = "Light"
	fontBold = "Light"
	fontItalic = "Light Italic"
	fontBoldItalic = "Light Italic"
	fontSize = 15
	fontBoldBright = true
	cols = 100
	rows = 24
	tabs = {{ $tabs }}
	shellPath = {{ $shellPath }}
	opacity = {{ int64 $opacity }}
{{ if lt $opacity (int64 1.0) }}
	blur = 20
{{ else }}
	blur = 0
{{ end}}

# TODO: full rewokr required to dict of variables
# Define terminal and OS / apps theme configuration
[data.theme]
	themeName = {{ $themeName | quote }}
	themeVariant = {{ $themeVariant | quote }}
	themeDarkMode = {{ $themeDarkMode }}

# Define user fonts location for macOS and Linux
[data.fonts]
{{ if eq .chezmoi.os "darwin" }}
	fontDir = {{ (joinPath .chezmoi.homeDir "Library/Fonts") | quote }}
{{ else if eq .chezmoi.os "linux" }}
	fontDir = {{ (joinPath .chezmoi.homeDir ".local/share/fonts") | quote }}
{{ end }}

# Define macOS homebrew location
{{ if eq .chezmoi.os "darwin" }}
[data.path]
	homebrew = {{ (joinPath .chezmoi.homeDir ".brew" | quote) }}
{{ end }}

#TODO: maybe refactorinmg required
[data.current]
	{{ if eq $themeName "catppuccin" }}
		{{ if eq $themeVariant "mocha" }}
			{{ if not $themeDarkMode }}
				{{ $bg = "1e1e2e" }}
			{{ end }}
			theme = { primary.foreground = "cdd6f4", primary.background = {{ $bg | quote }}, primary.dim_foreground = "7f849c", primary.bright_foreground = "cdd6f4", cursor.text = {{ $bg | quote }}, cursor.cursor = "f5e0dc", vi_mode_cursor.text = {{ $bg | quote }}, vi_mode_cursor.cursor = "b4befe", search.matches.foreground = {{ $bg | quote }}, search.matches.background = "a6adc8", search.focused_match.foreground = {{ $bg | quote }}, search.focused_match.background = "a6e3a1", footer_bar.foreground = {{ $bg | quote }}, footer_bar.background = "a6adc8", hints.start.foreground = {{ $bg | quote }}, hints.start.background = "f9e2af", hints.end.foreground = {{ $bg | quote }}, hints.end.background = "a6adc8", selection.text = {{ $bg | quote }}, selection.background = "f5e0dc", normal.black = "45475a", normal.red = "f38ba8", normal.green = "a6e3a1", normal.yellow = "f9e2af", normal.blue = "89b4fa", normal.magenta = "f5c2e7", normal.cyan = "94e2d5", normal.white = "bac2de", bright.black = "585b70", bright.red = "f38ba8", bright.green = "a6e3a1", bright.yellow = "f9e2af", bright.blue = "89b4fa", bright.magenta = "f5c2e7", bright.cyan = "94e2d5", bright.white = "a6adc8", indexed_colors.color16 = "fab387", indexed_colors.color17 = "f5e0dc", urls="89b4fa" }
		{{ end }}

		{{ if eq $themeVariant "macchiato" }}
			{{ if not $themeDarkMode }}
				{{ $bg = "24273a" }}
			{{ end }}
			theme = { primary.foreground = "cad3f5", primary.background = {{ $bg | quote }}, primary.dim_foreground = "8087a2", primary.bright_foreground = "cad3f5", cursor.text = {{ $bg | quote }}, cursor.cursor = "f4dbd6", vi_mode_cursor.text = {{ $bg | quote }}, vi_mode_cursor.cursor = "b7bdf8", search.matches.foreground = {{ $bg | quote }}, search.matches.background = "a5adcb", search.focused_match.foreground = {{ $bg | quote }}, search.focused_match.background = "a6da95", footer_bar.foreground = {{ $bg | quote }}, footer_bar.background = "a5adcb", hints.start.foreground = {{ $bg | quote }}, hints.start.background = "eed49f", hints.end.foreground = {{ $bg | quote }}, hints.end.background = "a5adcb", selection.text = {{ $bg | quote }}, selection.background = "f4dbd6", normal.black = "494d64", normal.red = "ed8796", normal.green = "a6da95", normal.yellow = "eed49f", normal.blue = "8aadf4", normal.magenta = "f5bde6", normal.cyan = "8bd5ca", normal.white = "b8c0e0", bright.black = "5b6078", bright.red = "ed8796", bright.green = "a6da95", bright.yellow = "eed49f", bright.blue = "8aadf4", bright.magenta = "f5bde6", bright.cyan = "8bd5ca", bright.white = "a5adcb", indexed_colors.color16 = "f5a97f", indexed_colors.color17 = "f4dbd6", urls="8aadf4" }
		{{ end }}

		{{ if eq $themeVariant "frappe" }}
			{{ if not $themeDarkMode }}
				{{ $bg = "303446" }}
			{{ end }}
			theme = { primary.foreground = "c6d0f5", primary.background = {{ $bg | quote }}, primary.dim_foreground = "838ba7", primary.bright_foreground = "c6d0f5", cursor.text = {{ $bg | quote }}, cursor.cursor = "f2d5cf", vi_mode_cursor.text = {{ $bg | quote }}, vi_mode_cursor.cursor = "babbf1", search.matches.foreground = {{ $bg | quote }}, search.matches.background = "a5adce", search.focused_match.foreground = {{ $bg | quote }}, search.focused_match.background = "a6d189", footer_bar.foreground = {{ $bg | quote }}, footer_bar.background = "a5adce", hints.start.foreground = {{ $bg | quote }}, hints.start.background = "e5c890", hints.end.foreground = {{ $bg | quote }}, hints.end.background = "a5adce", selection.text = {{ $bg | quote }}, selection.background = "f2d5cf", normal.black = "51576d", normal.red = "e78284", normal.green = "a6d189", normal.yellow = "e5c890", normal.blue = "8caaee", normal.magenta = "f4b8e4", normal.cyan = "81c8be", normal.white = "b5bfe2", bright.black = "626880", bright.red = "e78284", bright.green = "a6d189", bright.yellow = "e5c890", bright.blue = "8caaee", bright.magenta = "f4b8e4", bright.cyan = "81c8be", bright.white = "a5adce", indexed_colors16 = "ef9f76", indexed_colors17 = "f2d5cf", urls="8caaee" }
		{{ end }}

		{{ if eq $themeVariant "latte" }}
			theme = { primary.foreground = "4c4f69", primary.background = "eff1f5", primary.dim_foreground = "8c8fa1", primary.bright_foreground = "4c4f69", cursor.text = "eff1f5", cursor.cursor = "dc8a78", vi_mode_cursor.text = "eff1f5", vi_mode_cursor.cursor = "7287fd", search.matches.foreground = "eff1f5", search.matches.background = "6c6f85", search.focused_match.foreground = "eff1f5", search.focused_match.background = "40a02b", footer_bar.foreground = "eff1f5", footer_bar.background = "6c6f85", hints.start.foreground = "eff1f5", hints.start.background = "df8e1d", hints.end.foreground = "eff1f5", hints.end.background = "6c6f85", selection.text = "eff1f5", selection.background = "dc8a78", normal.black = "bcc0cc", normal.red = "d20f39", normal.green = "40a02b", normal.yellow = "df8e1d", normal.blue = "1e66f5", normal.magenta = "ea76cb", normal.cyan = "179299", normal.white = "5c5f77", bright.black = "acb0be", bright.red = "d20f39", bright.green = "40a02b", bright.yellow = "df8e1d", bright.blue = "1e66f5", bright.magenta = "ea76cb", bright.cyan = "179299", bright.white = "6c6f85", indexed_colors16 = "fe640b", indexed_colors17 = "dc8a78", urls="1e66f5" }
		{{ end }}
	{{ end }}
