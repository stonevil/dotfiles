{{- /*
	vim:ft=toml.gotexttmpl
*/ -}}

# Detect GUI Session Type
{{ if eq .chezmoi.os "linux" }}
[data.session]
	type = {{ env "XDG_SESSION_TYPE" | quote }}
	wsl = {{ (and (eq .chezmoi.os "linux") (.chezmoi.kernel.osrelease | lower | contains "microsoft")) }}
{{ else if eq .chezmoi.os "darwin" }}
[data.session]
	type = "darwin"
	wsl = false
{{ end }}

# Detect Desktop OR Laptop. And OS Theme
{{ $osTheme := "dark" }}
{{ $chassisType := "desktop" }}
{{ if eq .chezmoi.os "darwin" }}
	{{ if contains "Yes" (output  "/usr/sbin/ioreg" "-c" "AppleSmartBattery" "-r" "|" "awk" "'/built-in/" "{print $3}'") }}
		{{ $chassisType = "laptop" }}
	{{ else }}
		{{ $chassisType = "desktop" }}
	{{ end }}
{{ else if eq .chezmoi.os "linux" }}
	{{ if lookPath "hostnamectl" }}
		{{ if contains "systemd" (output "ps" "-aux") }}
			{{ $chassisType = (output "hostnamectl" "--json=short" | mustFromJson).Chassis }}
		{{ else }}
			{{ $chassisType = "desktop" }}
		{{ end }}
	{{ else }}
		{{ $chassisType = "desktop" }}
	{{ end }}
{{ else if eq .chezmoi.os "windows" }}
	{{ $chassisType = (output "powershell.exe" "-NoProfile" "-NonInteractive" "-Command" "if ((Get-CimInstance -Class Win32_Battery | Measure-Object).Count -gt 0) { Write-Output 'laptop' } else { Write-Output 'desktop' }") | trim }}
{{ end }}

# Boring with some questions
{{ $sudoAccess := false }}
{{ $python3 := false }}

{{ if eq .chezmoi.username "root" }}
	{{ $sudoAccess = true }}
{{ else }}
	{{ $sudoAccess = promptBool "Do you have sudo access?" false }}
{{ end }}
{{ $privateComputer := promptBool "Is this personal computer" true }}
{{ $uname := promptStringOnce . "Full Name" "What is your full name" "fubar" }}
{{ $email := promptStringOnce . "email" "What is your email address" "fu@bar.org" }}
{{ $osTheme := promptBool "Enable Dark Mode?" true }}
{{ $tmux := promptBool "Do you need terminal multiplexer" false }}
{{ $neovim := promptBool "Do you require NeoVIM IDE" false }}
{{ $dev := promptBool "Is this DEV workstation" false }}
{{ $containers := promptBool "Do you need containers tools" false }}
{{ $k8s := promptBool "Do you need K8S tools" false }}
{{ $embedded := promptBool "Is this Embedded DEV workstation" false }}
{{ $media := promptBool "Do you require basic tools for media manipulation" false }}
{{ $news := promptBool "Do you require news apps" false }}
{{ $deck := promptBool "Do you require TUI presentation tools" false }}
{{ $ads := promptBool "Do you want to block ads" false }}

{{ $tabs := promptInt "Configure default tabs width" 2 }}
{{ $opacity := promptString "Windows opacity" "1.0" }}
{{ $shellPath := promptString "Path to shell" "/bin/zsh" }}

{{ if or ($neovim) ($dev) }}
	{{ $tmux = true }}
{{ end }}

[data]
	email = {{ $email | quote }}
	uname = {{ $uname | quote }}

[data.tags]
	sudoAccess = {{ $sudoAccess }}
	neovim = {{ $neovim }}
	dev = {{ $dev }}
	containers = {{ $containers }}
	k8s = {{ $k8s }}
	embedded = {{ $embedded }}
	media = {{ $media }}
	news = {{ $news }}
	deck = {{ $deck }}
	ads = {{ $ads }}
	tmux = {{ $tmux }}
	python3 = {{ $python3 }}
{{ if eq $osTheme true }}
	osTheme = "dark"
{{ else }}
	osTheme = "light"
{{ end }}

[data.tui]
	shellPath = {{ $shellPath | quote }}
	tabs = {{ $tabs }}
{{ if eq $osTheme true }}
	theme = "catppuccin"
	themeVariant = "mocha"
{{ else }}
	theme = "catppuccin"
	themeVariant = "latte"
{{ end }}


# [data.tags]
# 	private = {{ $privateComputer }}
# 	core = true
# 	dev = false
# 	k8s = false
# 	esp = false
# 	media = false
# 	adblock = false
# 	laptop = false
# 	books = false
# 	news = false
# 	torrent = false
# 	tor = false


[data.arch]
{{ if eq .chezmoi.arch "amd64" }}
	opt1 = "{{ .chezmoi.arch }}"
	opt2 = "x86_64"
{{ else if eq .chezmoi.arch "arm64" }}
	opt1 = "{{ .chezmoi.arch }}"
	opt2 = "aarch64"
{{ end }}

[data.gui]
{{ if eq .chezmoi.os "darwin" }}
	fontDir = {{ (joinPath .chezmoi.homeDir "Library/Fonts") | quote }}
{{ else if eq .chezmoi.os "linux" }}
	fontDir = {{ (joinPath .chezmoi.homeDir ".local/share/fonts") | quote }}
{{ end }}

[data.terminal]
	fontsList = ["FiraCode", "Iosevka", "Monoid", "ProggyClean", "RobotoMono", "ZedMono"]
	font = "Iosevka Nerd Font"
	fontNormal = "Light"
	fontBold = "Light"
	fontItalic = "Light Italic"
	fontBoldItalic = "Light Italic"
	fontSize = 15
	fontBoldBright = true
	cols = 120
	rows = 28
	opacity = {{ $opacity }}
{{ if lt ($opacity | float64) 1.0 }}
	blur = 20
{{ else }}
	blur = 0
{{ end}}

{{ if eq .chezmoi.os "darwin" }}
[data.path]
	homebrew = {{ (joinPath .chezmoi.homeDir ".brew" | quote) }}
{{ end }}
