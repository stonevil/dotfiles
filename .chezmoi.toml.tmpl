{{- /*
	vim:ft=toml.gotexttmpl
*/ -}}

scriptTempDir = {{ (joinPath .chezmoi.homeDir ".tmp") | quote }}

# Detect desktop OR laptop. And OS theme
{{ $chassisType := "desktop" }}
{{ if eq .chezmoi.os "darwin" }}
	{{ if contains "Yes" (output  "/usr/sbin/ioreg" "-c" "AppleSmartBattery" "-r" "|" "awk" "'/built-in/" "{print $3}'") }}
		{{ $chassisType := "laptop" }}
	{{ else }}
		{{ $chassisType := "desktop" }}
	{{ end }}
{{ else if eq .chezmoi.os "linux" }}
	{{ if lookPath "hostnamectl" }}
		{{ if contains "systemd" (output "ps" "-aux") }}
			{{ $chassisType := (output "hostnamectl" "--json=short" | mustFromJson).Chassis }}
		{{ else }}
			{{ $chassisType := "desktop" }}
		{{ end }}
	{{ else }}
		{{ $chassisType := "desktop" }}
	{{ end }}
{{ end }}

# Ask questin about environment
{{ $ownership := "private" }}{{ if hasKey . "ownership" }}{{ $ownership = .ownership }}{{ end }}
{{ $ownership = (promptStringOnce . "Ownership" "Private or company property. Use company name for working computer" $ownership) | quote }}

{{ $uname := "fubar" }}{{ if hasKey . "uname" }}{{ $uname = .uname }}{{ end }}
{{ $uname = (promptStringOnce . "Full Name" "What is your full name" $uname) | quote }}

{{ $email := "fu@bar.org" }}{{ if hasKey . "email" }}{{ $email = .email }}{{ end }}
{{ $email = (promptStringOnce . "email" "What is your email address" $email) | quote }}


{{ $themeDarkMode := true }}
{{ $themeName := "catppuccin" }}
{{ $themeVariant := "mocha" }}
{{ $themeBlackout := true }}

{{ if hasKey . "theme" }}
	{{ if hasKey .theme "darkMode" }}{{ $themeDarkMode = .theme.darkMode }}{{ end }}
	{{ if hasKey .theme "name" }}{{ $themeName = .theme.name }}{{ end }}
	{{ if hasKey .theme "variant" }}{{ $themeVariant = .theme.variant }}{{ end }}
	{{ if hasKey .theme "blackout" }}{{ $themeBlackout = .theme.blackout }}{{ end }}
{{ end }}

{{ $themeDarkMode = promptBool "Are you prefer Dark Mode" $themeDarkMode }}
{{ $themeName = promptChoice "Choose Theme" (list "catppuccin") $themeName }}
{{ if eq $themeName "catppuccin" }}
	{{ if $themeDarkMode }}
		{{ $themeVariant = promptChoice "Theme Variant" (list "mocha") $themeVariant }}
		{{ $themeBlackout = promptBool "Theme Black background" $themeBlackout }}
	{{ else }}
		{{ $themeVariant = "latte" }}
	{{ end }}
{{ end }}

{{ $neovimCli := false }}
{{ $terminalMultiplexer := false }}
{{ $devToolsCli := false }}
{{ $dbToolsCli := false }}
{{ $vagrantCli := false }}
{{ $hashiCli := false }}
{{ $limaCli := false }}
{{ $k8sToolsCli := false }}
{{ $ansibleCli := false }}
{{ $espToolsCli := false }}
{{ $utilsCli := false }}
{{ $networkToolsCli := false }}
{{ $syncTools := false }}
{{ $mailCli := false }}
{{ $mediaToolsCli := false }}
{{ $newsCli := false }}
{{ $dekCli := false }}
{{ $adsToolsCli := false }}
{{ $gamesCli := false }}
{{ $fwupdCli := false }}
{{ $zephyrus := false }}
{{ $nvidia := false }}
{{ $thinkpad := false }}
{{ $xfce := false }}
{{ $labwc := false }}
{{ $plasma := false }}
{{ $hyprland := false }}
{{ $browsers := false }}
{{ $terminalEmulators := false }}
{{ $devTools := false }}
{{ $dbTools := false }}
{{ $messengers := false }}
{{ $mail := false }}
{{ $books := false }}
{{ $media := false }}
{{ $modeling := false }}
{{ $graphics := false }}
{{ $schematics := false }}
{{ $networkTools := false }}
{{ $virt := false }}
{{ $tor := false }}
{{ $torrent := false }}
{{ $utils := false }}

{{ if hasKey . "tags" }}
	{{ if hasKey .tags "neovimCli" }}{{ $neovimCli = .tags.neovimCli.enabled }}{{ end }}
	{{ if hasKey .tags "terminalMultiplexer" }}{{ $terminalMultiplexer = .tags.terminalMultiplexer.enabled }}{{ end }}
	{{ if hasKey .tags "devToolsCli" }}{{ $devToolsCli = .tags.devToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "dbToolsCli" }}{{ $dbToolsCli = .tags.dbToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "vagrantCli" }}{{ $vagrantCli = .tags.vagrantCli.enabled }}{{ end }}
	{{ if hasKey .tags "hashiCli" }}{{ $hashiCli = .tags.hashiCli.enabled }}{{ end }}
	{{ if hasKey .tags "limaCli" }}{{ $limaCli = .tags.limaCli.enabled }}{{ end }}
	{{ if hasKey .tags "k8sToolsCli" }}{{ $k8sToolsCli = .tags.k8sToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "ansibleCli" }}{{ $ansibleCli = .tags.ansibleCli.enabled }}{{ end }}
	{{ if hasKey .tags "espToolsCli" }}{{ $espToolsCli = .tags.espToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "utilsCli" }}{{ $utilsCli = .tags.utilsCli.enabled }}{{ end }}
	{{ if hasKey .tags "networkToolsCli" }}{{ $networkToolsCli = .tags.networkToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "syncTools" }}{{ $syncTools = .tags.syncTools.enabled }}{{ end }}
	{{ if hasKey .tags "mailCli" }}{{ $mailCli = .tags.mailCli.enabled }}{{ end }}
	{{ if hasKey .tags "mediaToolsCli" }}{{ $mediaToolsCli = .tags.mediaToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "newsCli" }}{{ $newsCli = .tags.newsCli.enabled }}{{ end }}
	{{ if hasKey .tags "dekCli" }}{{ $dekCli = .tags.dekCli.enabled }}{{ end }}
	{{ if hasKey .tags "adsToolsCli" }}{{ $adsToolsCli = .tags.adsToolsCli.enabled }}{{ end }}
	{{ if hasKey .tags "gamesCli" }}{{ $gamesCli = .tags.gamesCli.enabled }}{{ end }}
	{{ if hasKey .tags "fwupdCli" }}{{ $fwupdCli = .tags.fwupdCli.enabled }}{{ end }}
	{{ if hasKey .tags "zephyrus" }}{{ $zephyrus = .tags.zephyrus.enabled }}{{ end }}
	{{ if hasKey .tags "nvidia" }}{{ $nvidia = .tags.nvidia.enabled }}{{ end }}
	{{ if hasKey .tags "thinkpad" }}{{ $thinkpad = .tags.thinkpad.enabled }}{{ end }}
	{{ if hasKey .tags "xfce" }}{{ $xfce = .tags.xfce.enabled }}{{ end }}
	{{ if hasKey .tags "labwc" }}{{ $labwc = .tags.labwc.enabled }}{{ end }}
	{{ if hasKey .tags "plasma" }}{{ $plasma = .tags.plasma.enabled }}{{ end }}
	{{ if hasKey .tags "hyprland" }}{{ $hyprland = .tags.hyprland.enabled }}{{ end }}
	{{ if hasKey .tags "browsers" }}{{ $browsers = .tags.browsers.enabled }}{{ end }}
	{{ if hasKey .tags "terminalEmulators" }}{{ $terminalEmulators = .tags.terminalEmulators.enabled }}{{ end }}
	{{ if hasKey .tags "devTools" }}{{ $devTools = .tags.devTools.enabled }}{{ end }}
	{{ if hasKey .tags "dbTools" }}{{ $dbTools = .tags.dbTools.enabled }}{{ end }}
	{{ if hasKey .tags "messengers" }}{{ $messengers = .tags.messengers.enabled }}{{ end }}
	{{ if hasKey .tags "mail" }}{{ $mail = .tags.mail.enabled }}{{ end }}
	{{ if hasKey .tags "books" }}{{ $books = .tags.books.enabled }}{{ end }}
	{{ if hasKey .tags "media" }}{{ $media = .tags.media.enabled }}{{ end }}
	{{ if hasKey .tags "modeling" }}{{ $modeling = .tags.modeling.enabled }}{{ end }}
	{{ if hasKey .tags "graphics" }}{{ $graphics = .tags.graphics.enabled }}{{ end }}
	{{ if hasKey .tags "schematics" }}{{ $schematics = .tags.schematics.enabled }}{{ end }}
	{{ if hasKey .tags "networkTools" }}{{ $networkTools = .tags.networkTools.enabled }}{{ end }}
	{{ if hasKey .tags "virt" }}{{ $virt = .tags.virt.enabled }}{{ end }}
	{{ if hasKey .tags "tor" }}{{ $tor = .tags.tor.enabled }}{{ end }}
	{{ if hasKey .tags "torrent" }}{{ $torrent = .tags.torrent.enabled }}{{ end }}
	{{ if hasKey .tags "utils" }}{{ $utils = .tags.utils.enabled }}{{ end }}
{{ end }}

{{ $neovimCli = promptBool "NeoVIM IDE" $neovimCli }}
{{ $terminalMultiplexer = promptBool "Terminal Mutiplexer, like TMUX" $terminalMultiplexer }}
{{ $devToolsCli = promptBool "DEV CLI tools, like jq, bat" $devToolsCli }}
{{ $dbToolsCli = promptBool "DB management CLI tools, like usql" $dbToolsCli }}
{{ if eq .chezmoi.os "linux" }}
	{{ $vagrantCli = promptBool "HashiCorp Vagrant CLI tools" $vagrantCli }}
{{ end }}
{{ $hashiCli = promptBool "HashiCorp and Opentofu CLI tools" $hashiCli }}
{{ $limaCli = promptBool "Lima-VM CLI tools" $limaCli }}
{{ $k8sToolsCli = promptBool "K8S CLI tools" $k8sToolsCli }}
{{ $ansibleCli = promptBool "Ansible deployemnt and configuration CLI tools" $ansibleCli }}
{{ $espToolsCli = promptBool "ESP DEV tools" $espToolsCli }}
{{ $utilsCli = promptBool "Utils CLI tools, like smartmontools" $utilsCli }}
{{ $networkToolsCli := promptBool "Network CLI tools" $networkToolsCli }}
{{ $syncTools = promptBool "Sync CLI / GUI tools, like Syncthing" $syncTools }}
{{ $mailCli = promptBool "Mail CLI tools, like NeoMutt" $mailCli }}
{{ $mediaToolsCli = promptBool "Media CLI tools, like ffmpeg" $mediaToolsCli }}
{{ $newsCli := promptBool "News CLI tools, like NewsBoat" $newsCli }}
{{ $dekCli := promptBool "TUI presentation tools, like presenterm" $dekCli }}
{{ if eq .chezmoi.os "linux" }}
	{{ $adsToolsCli = promptBool "Ads block CLI tools, like hblock" $adsToolsCli }}
{{ end }}
{{ $gamesCli = promptBool "Some CLI games, like typing tutor" $gamesCli }}

{{ if eq .chezmoi.os "linux" }}
	{{ $fwupdCli = promptBool "Linux hardware firmware updater, fwupd" $fwupdCli }}

	{{ $zephyrus = promptBool "Is this ASUS Zephyrus line laptop" $zephyrus }}
	{{ if $zephyrus }}
		{{ $nvidia = promptBool "Enable Nvidia GPU" $nvidia }}
	{{ end }}

	{{ if eq $zephyrus false }}
		{{ $thinkpad = promptBool "Is this Lenovo Thinkpad line laptop" $thinkpad }}
	{{ end }}

	{{ $labwc = promptBool "Labwc DE" $labwc }}
	{{ $plasma = promptBool "KDE Plasma DE" $plasma }}
	{{ $hyprland = promptBool "Hyprland DE" $hyprland }}
{{ end }}

# Ask questin about environment if GUI env enabled
{{ if or (or ($labwc) ($plasma) ($hyprland)) (eq .chezmoi.os "darwin") }}
	{{ $browsers = promptBool "Web browsers, like LibreWolf" $browsers }}
	{{ $terminalEmulators = promptBool "GUI Terminal Emulators, like WezTerm" $terminalEmulators }}
	{{ $devTools = promptBool "DEV apps, like CotEditor" $devTools }}
	{{ $dbTools = promptBool "DB management tools, like DBeaver" $dbTools }}
	{{ $messengers = promptBool "Messengers apps, like Discord" $messengers }}
	{{ $mail = promptBool "Mail apps, like Thunderbird" $mail }}
	{{ $books = promptBool "Book management apps, like Calibre" $books }}
	{{ $media = promptBool "Media apps, like mpv, kid3" $media }}
	{{ $modeling = promptBool "3D modeling apps, like Blender, FreeCAD" $modeling }}
	{{ $graphics = promptBool "Graphics apps, Gimp, Krita" $graphics }}
{{ if ne .chezmoi.os "darwin" }}
	{{ $schematics = promptBool "Electronics and PCB design apps, like KiCad" $schematics }}
{{ end }}
	{{ $networkTools = promptBool "Network apps, like VNC/RDP clients" $networkTools }}
	{{ $virt = promptBool "Virtualisation apps, like UTM for macOS" $virt }}
	{{ $tor = promptBool "Tor network apps, like Tor Browser for macOS" $tor }}
	{{ $torrent = promptBool "Torrent network apps, like qBittorrent" $torrent }}
	{{ $utils = promptBool "Utils apps, like OnyX for macOS" $utils }}
{{ end }}

{{ $tabs := 2 }}
{{ $shellPath := "/bin/zsh" }}
{{ $opacity := 1.0 }}
{{ $opacityInactive := 0.8 }}
{{ $dimInactive := false }}
{{ $dimStrength := 0.5 }}

{{ if hasKey . "env" }}
	{{ if hasKey .env "tabs" }}{{ $tabs = int64 .env.tabs }}{{ end }}
	{{ if hasKey .env "shellPath" }}{{ $shellPath = .env.shellPath }}{{ end }}
	{{ if hasKey .env "opacity" }}{{ $opacity = .env.opacity }}{{ end }}
	{{ if hasKey .env "opacityInactive" }}{{ $opacityInactive = .env.opacityInactive }}{{ end }}
	{{ if hasKey .env "dimInactive" }}{{ $dimInactive = .env.dimInactive }}{{ end }}
	{{ if hasKey .env "dimStrength" }}{{ $dimStrength = .env.dimStrength }}{{ end }}
{{ end }}

{{ $tabs = promptInt "WARNING: default tabs width" (int64 $tabs) }}
{{ $shellPath = (promptString "WARNING: path to shell. Path should be absolute path to the already installed shell!" $shellPath) | quote }}
{{ $opacity = (promptString "WARNING: windows opacity, choose between 0.1 and 1.0" ($opacity | toString)) }}
{{ $opacityInactive = (promptString "WARNING: inactive windows opacity, choose between 0.1 and 1.0" ($opacityInactive | toString)) }}
{{ $dimInactive = (promptBool "WARNING: dim inactive windows" $dimInactive) }}
{{ if $dimInactive }}
{{ $dimStrength = (promptString "WARNING: dim inactive windows stregth, choose between 0.1 and 1.0" ($dimStrength | toString)) }}
{{ end }}

# Set user information
[data]
	email = {{ $email }}
	uname = {{ $uname }}
	ownership = {{ $ownership }}

# Define environment tags, packages, dependencies, etc.
[data.tags.core]
	enabled = true
	darwin = [
		"diffutils",
		"dos2unix",
		"git",
		"gawk",
		"gnu-sed",
		"gnu-tar",
		"gzip",
		"less",
		"star",
		"screen",
		"telnet",
		"tree",
		"unzip",
		"watch",
		"wget",
	]
	arch = [
		"yay",
		"bash",
		"bash-completion",
		"zsh",
		"extra/zsh-completions",
		"less",
		"man-db",
		"cpio",
		"dos2unix",
		"diffutils",
		"curl",
		"git",
		"inetutils",
		"less",
		"tree",
		"screen",
		"tar",
		"unzip",
		"wget",
		"which",
		"glibc-locales",
		"networkmanager",
		"bluetui",
	]
	fedora = [
		"bash",
		"bash-completion",
		"zsh",
		"less",
		"man-db",
		"cpio",
		"dos2unix",
		"diffutils",
		"curl",
		"git",
		"cracklib",
		"cracklib-dicts",
		"tree",
		"screen",
		"tar",
		"unzip",
		"wget",
		"which",
		"glibc-common",
	]
	pre.fedora = [
		"rpmfusion_add",
	]
	upgrade.darwin = [
		"yu",
		"yc",
	]
	upgrade.arch = [
		"yu",
		"yc",
	]
	upgrade.fedora = [
		"yu",
		"yc",
	]

[data.tags.python3]
	enabled = {{ if or ($neovimCli) ($devToolsCli) ($espToolsCli) ($mediaToolsCli) ($ansibleCli) }} true {{ else }} false {{ end }}
	darwin = [
		"python3",
		"uv",
	]
	arch = [
		"python",
		"python-pip",
		"uv",
	]
	uv = [
		"wheel==0.45.0",
	]
	pre.darwin = [
		"darwin_python3_library_lock",
	]
	post.darwin = [
		"brew unlink --quiet python3; brew link --overwrite --force --quiet python3",
		"brew_python3_relink",
	]
	upgrade.darwin = [
		"brew_python3_relink",
		"uv_upgrade",
	]
	cleanup.darwin = [
		"brew_python3_unlink",
	]
	upgrade.arch = [
		"uv_upgrade",
	]

[data.tags.go]
	enabled = {{ if or ($neovimCli) ($gamesCli) }} true {{ else }} false {{ end }}
	darwin = [
		"go",
		"delve",
		"golangci-lint",
	]
	arch = [
		"go",
		"delve",
		"golangci-lint",
	]

[data.tags.rust]
	enabled = {{ if or ($neovimCli) ($utilsCli) }} true {{ else }} false {{ end }}
	darwin = [
		"rust",
		"cargo-binstall",
		"cargo-update",
	]
	arch = [
		"rust",
		"cargo-binstall",
		"cargo-update",
	]

[data.tags.nodejs]
	enabled = {{ if or ($neovimCli) ($devToolsCli) }} true {{ else }} false {{ end }}
	darwin = [
		"node",
	]
	arch = [
		"nodejs",
		"npm",
	]
	npm = [
		"yarn",
	]
	upgrade.darwin = [
		"npm_update_self || true",
		"npm_update || true",
	]
	upgrade.arch = [
		"npm_update || true",
	]

[data.tags.lua]
	enabled = {{ if ($neovimCli) }} true {{ else }} false {{ end }}
	darwin = [
		"lua",
		"luajit",
		"luarocks",
	]
	arch = [
		"lua51",
		"lua",
		"luajit",
		"luarocks",
		"lua-luv",
	]

[data.tags.ruby]
	enabled = {{ if $neovimCli }} true {{ else }} false {{ end }}
	arch = [
		"ruby",
	]

[data.tags.gitCli]
	enabled = {{ if or ($neovimCli) ($devToolsCli) ($terminalMultiplexer) }} true {{ else }} false {{ end }}
	darwin = [
		"git",
		"git-lfs",
		"hub",
		"lazygit",
	]
	arch = [
		"git",
		"git-lfs",
		"hub",
		"lazygit",
	]

[data.tags.terminalMultiplexer]
	enabled = {{ $terminalMultiplexer }}
	darwin = [
		"tmux",
	]
	arch = [
		"tmux",
	]
	upgrade.darwin = [
		"tmux_plugins_update",
	]
	upgrade.arch = [
		"tmux_plugins_update",
	]
	upgrade.fedora = [
		"tmux_plugins_update",
	]

[data.tags.utilsCli]
	enabled = {{ $utilsCli }}
	darwin = [
		"parallel",
		"smartmontools",
		"dmg2img",
		"dua-cli",
	]
	arch = [
		"parallel",
		"dua-cli",
		"systemd-manager-tui",
		"lazyjournal",
	]
	cargo = [
		"battop",
	]

[data.tags.devToolsCli]
	enabled = {{ if or ($devToolsCli) ($neovimCli) }} true {{ else }} false {{ end }}
	darwin = [
		"ccache",
		"ccat",
		"gcc",
		"makedepend",
		"mkcert",
		"mkdocs",
		"eslint",
		"ninja",
		"the_silver_searcher",
		"ripgrep",
		"universal-ctags",
		"source-highlight",
		"bat",
		"jq",
		"jless",
		"stylua",
		"git-delta",
		"curlie",
		"ast-grep",
		"shellcheck",
		"marksman",
	]
	arch = [
		"base-devel",
		"ctags",
		"eslint",
		"ninja",
		"source-highlight",
		"the_silver_searcher",
		"ripgrep",
		"httpie",
		"bat",
		"jq",
		"jless",
		"stylua",
		"git-delta",
		"curlie",
		"ast-grep",
		"shellcheck",
		"marksman",
	]
	uv = [
		"httpie",
		"posting",
	]
	npm = [
		"@mermaid-js/mermaid-cli",
	]
	upgrade.darwin = [
		"bat_cache_update",
	]
	upgrade.arch = [
		"bat_cache_update",
	]
	upgrade.fedora = [
		"bat_cache_update",
	]

[data.tags.dbToolsCli]
	enabled = {{ $dbToolsCli }}
	darwin = [
		"xo/xo/usql",
	]
	arch = [
		"usql-bin",
	]

[data.tags.k8sToolsCli]
	enabled = {{ $k8sToolsCli }}
	darwin = [
		"kubectl",
		"krew",
		"k9s",
		"stern",
		"helm",
	]
	arch = [
		"kubectl",
		"krew",
		"k9s",
		"stern",
		"helm",
	]
	krew = [
		"ctr",
		"ctx",
		"exec-as",
		"fuzzy",
		"mtail",
		"ns",
		"node-admin",
		"node-restart",
		"node-shell",
		"restart",
		"view-allocations",
		"view-secret",
		"view-utilization",
	]
	upgrade.darwin = [
		"krew_upgrade",
	]
	upgrade.arch = [
		"krew_upgrade",
	]
	upgrade.fedora = [
		"krew_upgrade",
	]

[data.tags.ansibleCli]
	enabled = {{ $ansibleCli }}
	uv = [
		"ansible",
		"ansible-lint",
		"molecule",
		"ansible-navigator",
		"yamllint",
	]

[data.tags.neovimCli]
	enabled = {{ $neovimCli }}
	darwin = [
		"neovim",
		"lua-language-server",
	]
	arch = [
		"neovim",
		"lua-language-server",
	]
	fedora = [
		"neovim",
	]
	uv = [
		"pynvim",
		"flake8",
		"yamllint",
		"ruff",
		"gitlint-core",
	]
	npm = [
		"neovim",
		"cspell",
	]
	rocks = [
		"jsregexp",
		{{ if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "fedora") }}"lua-language-server",{{ end }}
	]
	gem = [
		{{ if eq .chezmoi.os "linux" }}"neovim",{{ end }}
	]
	upgrade.darwin = [
		"nvim_plugins_update",
	]
	upgrade.arch = [
		"nvim_plugins_update",
	]
	upgrade.fedora = [
		"nvim_plugins_update",
	]

[data.tags.limaCli]
	enabled = {{ if ($limaCli) }} true {{ else }} false {{ end }}

[data.tags.virtCli]
	enabled = {{ if ($limaCli) }} true {{ else }} false {{ end }}
	darwin = [
		"qemu",
	]
	arch = [
		"qemu-full",
		"virtiofsd",
	]
	fedora = [
		"qemu",
		"virtiofsd",
	]

[data.tags.fwupdCli]
	enabled = {{ $fwupdCli }}
	arch = [
		"fwupd",
	]
	fedora = [
		"fwupd",
	]
	post.arch = [
		"sudo systemctl enable --now fwupd-refresh.timer",
	]
	upgrade.arch = [
		"fwupd_update",
	]
	post.fedora = [
		"sudo systemctl enable --now fwupd-refresh.timer",
	]
	upgrade.fedora = [
		"fwupd_update",
	]

[data.tags.mediaToolsCli]
	enabled = {{ $mediaToolsCli }}
	darwin = [
		"jpeg",
		"imagemagick",
		"ffmpeg",
		"deno",
	]
	darwinhead = [
		"yt-dlp",
	]
	arch = [
		"imagemagick",
		"ffmpeg",
		"yt-dlp",
		"yt-dlp-ejs",
		"deno",
		"xytz-bin",
	]
	fedora = [
		"ImageMagick",
	]
	pre.fedora = [
		"sudo dnf swap -y --allowerasing ffmpeg-free ffmpeg",
		"sudo dnf swap -y --allowerasing libavcodec-free libavcodec-freeworld",
	]

[data.tags.adsToolsCli]
	enabled = {{ $adsToolsCli }}
	arch = [
		"hblock",
	]
	upgrade.arch = [
		"hblock_update",
	]
	remove.arch = [
		"if command -v hblock >/dev/null 2>&1; then hblock --sources none --denylist none; fi",
	]

[data.tags.gamesCli]
	enabled = {{ $gamesCli }}
	darwin = [
		"typioca",
	]
	arch = [
		"typioca-bin",
	]
	go = [
		{{ if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "fedora" ) }}"github.com/bloznelis/typioca@latest",{{ end }}
	]

[data.tags.dekCli]
	enabled = {{ $dekCli }}

[data.tags.newsCli]
	enabled = {{ $newsCli }}
	darwinhead = [
		"stonevil/brew/curl-impersonate",
	]
	darwin = [
		"newsboat",
	]
	arch = [
		"newsboat",
		"curl-impersonate",
	]

[data.tags.mailCli]
	enabled = {{ $mailCli }}
	darwin = [
		"neomutt",
	]
	arch = [
		"neomutt",
	]

[data.tags.networkToolsCli]
	enabled = {{ $networkToolsCli }}
	darwin = [
		"nmap",
	]
	arch = [
		"nmap",
	]

[data.tags.syncTools]
	enabled = {{ if ($syncTools) }} true {{ else }} false {{ end }}
	darwin = [
		"syncthing",
	]
	arch = [
		"syncthing",
	]
	post.darwin = [
		"mkdir -p ${HOME}/Library/LaunchAgents && chflags nouchg ${HOME}/Library/LaunchAgents && brew services start syncthing && chflags uchg ${HOME}/Library/LaunchAgents",
	]
	post.arch = [
		"systemctl --user enable syncthing.service",
	]
	remove.darwin = [
		"mkdir -p ${HOME}/Library/LaunchAgents && chflags nouchg ${HOME}/Library/LaunchAgents && brew services stop syncthing && chflags uchg ${HOME}/Library/LaunchAgents",
	]

[data.tags.hashiCli]
	enabled = {{ $hashiCli }}
	darwin = [
		"opentofu",
	]
	arch = [
		"opentofu",
	]

[data.tags.vagrantCli]
	enabled = {{ $vagrantCli }}
	arch = [
		"vagrant",
	]
	vagrant = [
		{{- if eq .chezmoi.os "linux" }}
		"vagrant-libvirt",
		"vagrant-vbguest",
		"vagrant-reload",
		{{- end }}
	]
	upgrade.arch = [
		"vagrant_plugins_update",
	]

[data.tags.espToolsCli]
	enabled = {{ $espToolsCli }}
	pre.darwin = [
		"brew_python3_relink",
	]
	upgrade.darwin = [
		"brew_python3_relink",
		"esp_idf_update",
	]
	upgrade.arch = [
		"esp_idf_update",
	]
	remove.darwin = [
		'if [[ -d {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }}; fi; if [[ -d {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }}; fi',
	]
	remove.arch = [
		'if [[ -d {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/esp-idf") | quote }}; fi; if [[ -d {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }} ]]; then rm -rf {{ (joinPath .chezmoi.homeDir ".local/xtensa-esp32-elf") | quote }}; fi',
	]

[data.tags.displayManager]
	enabled = {{ if or ($labwc) ($hyprland) ($plasma) }} true {{ else }} false {{ end }}
	arch = [
		"ly",
		"brightnessctl",
	]
	post.arch = [
		"sudo systemctl enable --now ly@tty2.service",
		"sudo systemctl disable --now getty@tty2.service",
	]
	remove.arch = [
		"sudo systemctl enable --now getty@tty2.service",
	]

[data.tags.spell]
	enabled = {{ if or ($labwc) ($hyprland) ($plasma) }} true {{ else }} false {{ end }}
	arch = [
		"sonnet",
		"hunspell",
		"hunspell-en_us",
		"hunspell-en_gb",
	]

[data.tags.fontTools]
	enabled = {{ if or ($labwc) ($hyprland) ($plasma) (eq .chezmoi.os "darwin") }} true {{ else }} false {{ end }}
	darwin = [
		"fontconfig",
	]
	arch = [
		"fontconfig",
	]
	upgrade.darwin = [
		"fonts_cache_update",
	]
	upgrade.arch = [
		"fonts_cache_update",
	]

[data.tags.printManager]
	enabled = {{ if or ($labwc) ($hyprland) ($plasma) }} true {{ else }} false {{ end }}
	arch = [
		"print-manager",
		"cups",
		"cups-pdf",
		"system-config-printer",
		"ghostscript",
		"gsfonts",
		"gutenprint",
		"foomatic-db",
		"foomatic-db-engine",
		"foomatic-db-nonfree",
		"foomatic-db-ppds",
		"gutenprint",
		"foomatic-db-gutenprint-ppds",
	]
	upgrade.arch = [
		"sudo cups-genppdupdate",
	]

[data.tags.bluetooth]
	enabled = {{ if or ($labwc) ($hyprland) ($plasma) }} true {{ else }} false {{ end }}
	arch = [
		"bluez",
		"bluez-utils",
	]
	post.arch = [
		"sudo systemctl enable --now bluetooth",
	]

[data.tags.xfce]
	enabled = {{ $xfce }}
	fedora = [
		"@base-x",
		"xrdp",
		"xorgxrdp",
		"xfconf",
		"xfdesktop",
		"xfwm4",
		"xfce4-session",
		"xfce4-settings",
		"xfce4-panel",
		"xfce4-places-plugin",
		"xfce4-xkb-plugin",
		"xfce4-terminal",
		"thunar",
		"thunar-archive-plugin",
		"materia-gtk-theme",
		"ristretto",
		"mousepad",
	]

[data.tags.wayland]
	enabled = {{ if or ($labwc) ($hyprland) ($plasma) }} true {{ else }} false {{ end }}
	arch = [
		"gojq",
		"archlinux-xdg-menu",
		"wl-clipboard",
		"wf-recorder",
		"xdgcli-git",
		"satty",
		"imv",
		"kanshi",
		"lswt",
		"mako",
		"wlr-randr",
		"qt6-wayland",
		"qt6ct-kde",
		"udiskie",
		"pamixer",
		"playerctl",
		"cliphist",
		"nwg-look",
		"wev",
		"xwaylandvideobridge",
		"wayland-satellite",
		"pipewire",
		"wireplumber",
		"wiremix",
		"waybar",
		"hypridle",
		"hyprlock",
	]

[data.tags.labwc]
	enabled = {{ $labwc }}
	arch = [
		"labwc",
		"swaybg",
	]

[data.tags.hyprland]
	enabled = {{ $hyprland }}
	arch = [
		"hyprland",
		"hyprland-guiutils",
		"xdg-desktop-portal-hyprland",
		"hyprcursor",
		"hyprshot",
		"hyprpolkitagent",
		"hyprpaper",
		"hyprpicker",
		"walker",
		"elephant",
		"elephant-desktopapplications",
		"elephant-files",
		"elephant-menus",
		"elephant-clipboard",
	]

[data.tags.plasma]
	enabled = {{ $plasma }}
	arch = [
		"plasma-desktop",
		"kscreen",
		"okular",
		"ark",
		"kcalc",
		"dolphin",
		"dolphin-plugins",
		"kde-gtk-config",
		"xdg-desktop-portal",
		"xdg-desktop-portal-kde",
		"kscreenlocker",
		"plasma-pa",
		"plasma-nm",
		"breeze",
		"breeze-gtk",
		"kpipewire",
		"plasma-disks",
		"plasma-browser-integration",
		"plasma-systemmonitor",
		"plasma-thunderbolt",
		"bluedevil",
		"powerdevil",
		"print-manager",
		"spectacle",
		"partitionmanager",
		"marknote",
		"kdialog",
		"extra/qt6-tools",
		"wl-clipboard",
		"kwallet",
		"kwalletmanager",
		"kwallet-pam",
		"ksshaskpass",
	]

[data.tags.browsers]
	enabled = {{ $browsers }}
	darwin = [
		"librewolf",
		"waterfox",
		"stonevil/brew/ungoogled-chromium",
	]
	arch = [
		"librewolf-bin",
		"waterfox-bin",
		"ungoogled-chromium-bin",
	]
	pre.fedora = [
		"curl -fsSL https://repo.librewolf.net/librewolf.repo | sudo tee /etc/yum.repos.d/librewolf.repo",
	]
	cleanup.fedora = [
		"sudo rm -f /etc/yum.repos.d/librewolf.repo",
	]

[data.tags.networkTools]
	enabled = {{ $networkTools }}
	arch = [
		"krdc",
		"libvncserver",
		"freerdp",
	]

[data.tags.devTools]
	enabled = {{ $devTools }}
	darwin = [
		"kdiff3",
		"coteditor",
		"keycastr",
		"kommit",
	]
	arch = [
		"kdiff3",
		"kompare",
		"kommit",
	]

[data.tags.dbTools]
	enabled = {{ $dbTools }}
	darwin = [
		"dbeaver-community",
	]
	arch = [
		"dbeaver",
	]

[data.tags.messengers]
	enabled = {{ $messengers }}
	darwin = [
		"discord",
	]
	arch = [
		"discord",
	]

[data.tags.mail]
	enabled = {{ $mail }}
	darwin = [
		"thunderbird",
	]
	arch = [
		"thunderbird",
		"thunderbird-i18n-uk",
		"thunderbird-dark-reader",
		"thunderbird-ublock-origin",
	]

[data.tags.media]
	enabled = {{ $media }}
	darwin = [
		"stonevil/brew/mpv",
		"kid3",
		"stonevil/brew/xact",
		"handbrake",
	]
	arch = [
		"mpv",
		"kid3",
		"handbrake",
	]
	fedora = [
		"mpv",
	]

[data.tags.books]
	enabled = {{ $books }}
	darwin = [
		"calibre",
		"bookokrat",
	]
	arch = [
		"calibre",
		"bookokrat-bin",
	]

[data.tags.virt]
	enabled = {{ $virt }}
	darwin = [
		"utm",
	]
	arch = [
		"karton",
		"virt-manager",
	]
	post.arch = [
		"sudo usermod -a -G libvirt-qemu ${USER}",
		"sudo systemctl enable --now libvirtd.service",
		"sudo systemctl enable --now libvirtd.socket",
	]

[data.tags.tor]
	enabled = {{ $tor }}
	darwin = [
		"tor-browser",
	]
	arch = [
		"torbrowser-launcher",
	]

[data.tags.torrent]
	enabled = {{ $torrent }}
	darwin = [
		"stonevil/brew/qbittorrent",
	]
	arch = [
		"qbittorrent",
	]
	fedora = [
		"qbittorrent",
	]

[data.tags.utils]
	enabled = {{ $tor }}
	darwin = [
		"keepingyouawake",
		"onyx",
		"homebrew/cask/sloth",
	]
	arch = [
		"kdiskmark",
	]

[data.tags.terminalEmulators]
	enabled = {{ $terminalEmulators }}
	darwin = [
		"timg",
		"wezterm",
	]
	arch = [
		"timg",
		"foot",
		"foot-terminfo",
		"wezterm",
	]

[data.tags.modeling]
	enabled = {{ $modeling }}
	darwin = [
		"freecad",
		"blender",
		"handbrake",
	]
	arch = [
		"freecad",
		"blender",
		"handbrake",
	]

[data.tags.graphics]
	enabled = {{ $graphics }}
	darwin = [
		"imageoptim",
		"krita",
		"gimp",
		"inkscape",
	]
	arch = [
		"optiimage",
		"krita",
		"gimp",
		"inkscape",
	]

[data.tags.schematics]
	enabled = {{ $schematics }}
	arch = [
		"kicad",
		"kicad-library",
		"kicad-library-3d",
		"python-kikit",
		"python-pcbnewtransition",
		"openboardview",
	]
	fedora = [
		"kicad",
		"kicad-doc",
		"kicad-packages3d",
	]

[data.tags.laptop]
	enabled = {{ if or ($zephyrus) ($thinkpad) }}true{{ else }}false{{ end }}
	arch = [
		"bolt",
		"nvme-cli",
		"powerstat",
		"upower",
		"usbutils",
		"pciutils",
	]

[data.tags.intel]
	enabled = {{ if or ($zephyrus) ($thinkpad) }}true{{ else }}false{{ end }}
	arch = [
		"intel-ucode",
		"intel-media-driver",
		"intel-gpu-tools",
		"smartmontools",
		"linux-firmware-intel",
		"libva-intel-driver-irql",
	]

[data.tags.nvidia]
	enabled = {{ $nvidia }}
	arch = [
		"nvidia-open-dkms",
		"nvidia-utils",
		"libva-nvidia-driver",
		"nvidia-prime",
		{{- if $zephyrus }}
		"supergfxctl",
		"plasma6-applets-supergfxctl",
		{{- end }}
	]
	post.arch = [
		"sudo systemctl enable nvidia-{suspend,resume,hibernate,suspend-then-hibernate,powerd}.service",
	]
	remove.arch = [
		"sudo systemctl disable --now nvidia-{suspend,resume,hibernate,suspend-then-hibernate,powerd}.service",
		{{- if $zephyrus }}
		"sudo systemctl disable --now supergfxd",
		{{- end }}
	]

# TODO: add more sophisticated hardware detection
# Hardware specific configs
[data.tags.zephyrus]
	enabled = {{ $zephyrus }}
	arch = [
		"asusctl",
		"bat-asus-battery-bin",
		"rog-control-center",
		"linux-g14",
		"linux-g14-headers",
		"power-profiles-daemon",
		"aic94xx-firmware",
		"ast-firmware",
		"upd72020x-fw",
		"linux-firmware-qlogic",
		"wd719x-firmware",
		"sof-firmware",
	]
	pre.arch = [
		"cd /tmp && wget 'https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x8b15a6b0e9a3fa35' -O g14.sec",
		"sudo pacman-key -a /tmp/g14.sec",
		"sudo pacman-key --recv-keys 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"sudo pacman-key --finger 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"sudo pacman-key --lsign-key 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"sudo pacman-key --finger 8F654886F17D497FEFE3DB448B15A6B0E9A3FA35",
		"grep -qF '[g14]' /etc/pacman.conf || echo -e '\n[g14]\nServer = https://arch.asus-linux.org' | sudo tee -a /etc/pacman.conf >/dev/null",
	]
	post.arch = [
		"sudo systemctl enable --now power-profiles-daemon",
	]

[data.tags.thinkpad]
	enabled = {{ $thinkpad }}
	arch = [
		"sof-firmware",
		"easyeffects",
	]

# Define terminal, DE like Hyprland env like tabs width, opacity, etc.
[data.env]
	fontsList = ["FiraCode", "Iosevka", "IosevkaTerm", "Monoid", "ProggyClean", "RobotoMono", "JetBrainsMono",]
	font = "Iosevka Nerd Font"
	fontNormal = "Light"
	fontBold = "Light"
	fontItalic = "Light Italic"
	fontBoldItalic = "Light Italic"
	fontSize = 15
	fontBoldBright = true
	cols = 120
	rows = 32
	tabs = {{ $tabs }}
	shellPath = {{ $shellPath }}
	opacity = {{ (float64 $opacity) }}
	opacityInactive = {{ (float64 $opacityInactive) }}
	dimInactive = {{ $dimInactive }}
	dimStrength = {{ (float64 $dimStrength) }}
{{ if lt (float64 $opacity) 1.0 }}
	blur = 20
{{ else }}
	blur = 0
{{ end}}

# TODO: full rewokr required to dict of variables
# Define terminal and OS / apps theme configuration
[data.theme]
	name = {{ $themeName | quote }}
	variant = {{ $themeVariant | quote }}
	darkMode = {{ $themeDarkMode }}
	blackout = {{ $themeBlackout }}

# Define user fonts location for macOS and Linux
[data.fonts]
{{ if eq .chezmoi.os "darwin" }}
	fontDir = {{ (joinPath .chezmoi.homeDir "Library/Fonts") | quote }}
{{ else if eq .chezmoi.os "linux" }}
	fontDir = {{ (joinPath .chezmoi.homeDir ".local/share/fonts") | quote }}
{{ end }}

# Define macOS homebrew location
{{ if eq .chezmoi.os "darwin" }}
[data.path]
	homebrew = {{ (joinPath .chezmoi.homeDir ".brew" | quote) }}
{{ end }}

#TODO: maybe refactorinmg required
[data.colours]
	{{ if eq $themeName "catppuccin" }}
		{{ if eq $themeVariant "mocha" }}
			normal = { black = "45475a", white = "bac2de", red = "f38ba8", green = "a6e3a1", yellow = "f9e2af", blue = "89b4fa", magenta = "f5c2e7", cyan = "94e2d5", indexed_colors = { color16 = "fab387", color17 = "f5e0dc" }, background = "1e1e2e", foreground = "cdd6f4", urls="89b4fa", rosewater = "f5e0dc", flamingo = "f2cdcd", pink = "f5c2e7", mauve = "cba6f7", maroon = "eba0ac", peach = "fab387", teal = "94e2d5", sky = "89dceb", sapphire = "74c7ec", lavender = "b4befe", text = "cdd6f4", subtext1 = "bac2de", subtext0 = "a6adc8", overlay2 = "9399b2", overlay1 = "7f849c", overlay0 = "6c7086", surface2 = "585b70", surface1 = "45475a", surface0 = "313244", base = "1e1e2e", mantle = "181825", crust = "11111b" }
			bright = { black = "585b70", white = "a6adc8", red = "f38ba8", green = "a6e3a1", yellow = "f9e2af", blue = "89b4fa", magenta = "f5c2e7", cyan = "94e2d5", background = "1e1e2e", foreground = "cdd6f4" }
			dim = { foreground = "7f849c" }
			cursor = { text = "1e1e2e", cursor = "f5e0dc", vi_mode = { text = "1e1e2e", cursor = "b4befe" }, line = "2a2b3c", secondary = { cursor = "b5a6a8", select = "878ec0", normal = "b5a6a8", insert = "7ea87f" } }
			search = { matches = { foreground = "1e1e2e", background = "a6adc8" }, focused_match = { foreground = "1e1e2e", background = "a6e3a1" } }
			footer_bar = { foreground = "1e1e2e", background = "a6adc8" }
			hints = { start = { foreground = "1e1e2e", background = "f9e2af" }, end = { foreground = "1e1e2e", background = "a6adc8" } }
			selection = { text = "1e1e2e", background = "f5e0dc" }
		{{ end }}
	{{ end }}
