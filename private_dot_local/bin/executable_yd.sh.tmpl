#!/usr/bin/env bash
# vim:ft=bash

trap "exit" INT

media_url="$@"

if [[ -z "${media_url}" ]]; then
	read -p "Please provide URL: " media_url
fi

yt_user_agent={{ .web.ytUserAgent | quote }}

cd {{ (joinPath .chezmoi.homeDir "Downloads") | quote }} || exit 1

yt_title=$(yt-dlp -4 --skip-download --get-title --no-warnings "$media_url" | sed 2d)
printf "%s\n" "Download media: $yt_title"

yt-dlp --no-warnings --user-agent "$yt_user_agent" --embed-metadata --embed-thumbnail --recode-video mp4 --audio-format m4a --merge-output-format mp4 "$media_url"
