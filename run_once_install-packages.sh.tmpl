#!/usr/bin/env sh

curl -L git.io/antigen > "$HOME"/.antigen.zsh

{{ if eq .chezmoi.os "linux" -}}
if command -v pacman >/dev/null; then
	if grep -q docker /proc/1/cgroup; then
		patched_glibc=glibc-linux4-2.33-4-x86_64.pkg.tar.zst && curl -LO "https://raw.githubusercontent.com/sickcodes/Docker-OSX/master/${patched_glibc}" && bsdtar -C / -xvf "${patched_glibc}" || echo "Everything is fine."
	fi
	sudo pacman -Sy --noconfirm zsh git gopass
fi
usermod -s /bin/zsh "$(id -u -n)"

{{ else if eq .chezmoi.os "darwin" -}}
if [ -d "$HOME"/.homebrew ]; then
	rm -Rf "$HOME"/.homebrew
fi
git clone https://github.com/Homebrew/brew.git "$HOME"/.homebrew
export PATH="$HOME"/.homebrew/bin:$PATH
brew update && brew upgrade && brew upgrade --cask

brew bundle --no-lock --file=/dev/stdin <<EOF
brew "git"
EOF
{{ end -}}
