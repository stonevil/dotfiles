#!/usr/bin/env sh
# vim:ft=bash.gotexttmpl

cd "$HOME" || exit 1

echo "Prepare system. Install essential packages like brew, etc"
{{ if eq .chezmoi.os "darwin" }}
	{{ if stat .path.homebrew }}
		rm -Rf {{ .path.homebrew | quote }}
	{{ end }}
	git clone https://github.com/Homebrew/brew.git {{ .path.homebrew | quote }} || exit 1
	{{ template "darwin.tmpl" . }}
	brew tap --force homebrew/core || exit 1
	brew install --force bash curl git gnu-tar wget ruby || exit 1
{{ else if eq .chezmoi.os "linux" }}
	{{ if eq .chezmoi.osRelease.id "alpine" }}
		{{ template "alpine.tmpl" . }}
		sudo apk --update add bash curl git tar wget || exit 1
	{{ else if eq .chezmoi.osRelease.id "arch" }}
		{{ template "arch.tmpl" . }}
		(sudo pacman --noconfirm --needed -Syu bash base-devel curl git tar wget) || exit 1
	{{ else if (or (eq .chezmoi.osRelease.id "centos") (eq .chezmoi.osRelease.id "fedora")) }}
		{{ template "fedora.tmpl" . }}
		sudo dnf update -y bash curl git tar wget || exit 1
	{{ end }}
{{ end }}