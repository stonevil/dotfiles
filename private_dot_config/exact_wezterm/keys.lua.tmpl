{{- /*
	vim:ft=lua.gotexttmpl
*/ -}}

local wezterm = require("wezterm")
local act = wezterm.action
local M = {}

function M.setup(config)
	config.keys = {
		{ key = "mapped:#", mods = "META", action = "DisableDefaultAssignment" },
		{ key = "mapped:≠", mods = "META", action = "DisableDefaultAssignment" },
		{ key = "mapped:€", mods = "META", action = "DisableDefaultAssignment" },
		{ key = "mapped:´", mods = "META", action = "DisableDefaultAssignment" },
		{ key = "mapped:…", mods = "META", action = "DisableDefaultAssignment" },
		{ key = "mapped:≈", mods = "META", action = "DisableDefaultAssignment" },

	{{- if eq .chezmoi.os "darwin" }}
		{ key = "q", mods = "SUPER", action = "QuitApplication" },
		{ key = "w", mods = "SUPER", action = wezterm.action({ CloseCurrentTab = { confirm = true } }) },
		{ key = "t", mods = "SUPER", action = wezterm.action({ SpawnTab = "CurrentPaneDomain" }) },
		{ key = "}", mods = "SUPER|SHIFT", action = wezterm.action({ ActivateTabRelative = 1 }) },
		{ key = "{", mods = "SUPER|SHIFT", action = wezterm.action({ ActivateTabRelative = -1 }) },
		{ key = "f", mods = "SUPER|CTRL", action = wezterm.action.ToggleFullScreen },
		{ key = "m", mods = "SUPER", action = wezterm.action.Hide },
		{ key = "h", mods = "SUPER", action = wezterm.action.HideApplication },
		{
			key = "\\",
			mods = "META",
			action = wezterm.action({
				SplitHorizontal = { domain = "CurrentPaneDomain" },
			}),
		},
		{
			key = "-",
			mods = "META",
			action = wezterm.action({
				SplitVertical = { domain = "CurrentPaneDomain" },
			}),
		},
		{
			key = "w",
			mods = "META",
			action = wezterm.action({ CloseCurrentPane = { confirm = false } }),
		},
		{
			key = "t",
			mods = "META|SUPER",
			action = wezterm.action_callback(function(_, pane)
				local _, _ = pane:move_to_new_tab()
			end),
		},

		{ key = "p", mods = "SUPER", action = wezterm.action.ActivateCommandPalette },

		{
			key = "f",
			mods = "SUPER",
			action = wezterm.action.ShowLauncherArgs({ flags = "FUZZY|TABS", title = "LAUNCHER" }),
		},

		{ key = "s", mods = "SUPER", action = wezterm.action.QuickSelect },
		{ key = "d", mods = "SUPER|SHIFT", action = wezterm.action.ShowDebugOverlay },
		{ key = "\\", mods = "SUPER", action = act.PaneSelect({ alphabet = "1234567890" }) },
		{ key = "z", mods = "META|SHIFT", action = wezterm.action.TogglePaneZoomState },
		{ key = "l", mods = "META|SHIFT", action = wezterm.action.ActivateLastTab },
		{ key = "?", mods = "META|SHIFT", action = wezterm.action.ActivateCopyMode },
		{ key = "0", mods = "SUPER", action = wezterm.action.ResetFontSize },
		{ key = "=", mods = "SUPER", action = wezterm.action.IncreaseFontSize },
		{ key = "-", mods = "SUPER", action = wezterm.action.DecreaseFontSize },
		{ key = "v", mods = "SUPER", action = act.PasteFrom("Clipboard") },
		{ key = "c", mods = "SUPER", action = wezterm.action.CopyTo("ClipboardAndPrimarySelection") },

		{ key = "f", mods = "META", action = wezterm.action.Search("CurrentSelectionOrEmptyString") },
		-- Navigation within search results:
		-- Type or paste the search pattern in the bar at the bottom of the screen.
		-- Use Enter, UpArrow/CTRL-P, PageUp to move to previous matches, and DownArrow/CTRL-N, PageDown to move to the next matches.
		-- CTRL-R cycles through pattern matching modes (case-sensitive, case-insensitive, regex).
		-- CTRL-U clears the search pattern.
		-- CTRL-SHIFT-C copies the selected text to the clipboard.
		-- Escape cancels the search overlay.

		-- {
		-- 	key = "s",
		-- 	mods = "META|SUPER",
		-- 	action = wezterm.action_callback(function(win, pane)
		-- 			resurrect.state_manager.save_state(resurrect.workspace_state.get_workspace_state())
		-- 			resurrect.window_state.save_window_action()
		-- 		end),
		-- },
		--
		-- {
		-- 	key = "r",
		-- 	mods = "META|SUPER",
		-- 	action = wezterm.action_callback(function(win, pane)
		-- 		resurrect.fuzzy_load(win, pane, function(id, label)
		-- 			local type = string.match(id, "^([^/]+)")
		-- 			id = string.match(id, "([^/]+)$")
		-- 			id = string.match(id, "(.+)%..+$")
		-- 			local opts = {
		-- 				relative = true,
		-- 				restore_text = true,
		-- 				on_pane_restore = resurrect.tab_state.default_on_pane_restore,
		-- 			}
		-- 			if type == "workspace" then
		-- 				local state = resurrect.load_state(id, "workspace")
		-- 				resurrect.workspace_state.restore_workspace(state, opts)
		-- 			elseif type == "window" then
		-- 				local state = resurrect.load_state(id, "window")
		-- 				resurrect.window_state.restore_window(pane:window(), state, opts)
		-- 			elseif type == "tab" then
		-- 				local state = resurrect.load_state(id, "tab")
		-- 				resurrect.tab_state.restore_tab(pane:tab(), state, opts)
		-- 			end
		-- 		end)
		-- 	end),
		-- },
	}
	{{- end }}
	{{- if eq .chezmoi.os "linux" }}
	{{- end }}
end

return M
