{{- /*
vim:ft=bash.gotexttmpl
*/ -}}

alias ls='ls --color=auto'
alias l='ls -lhF'
alias ll='ls -AlhF'
alias la='ls -AhF'

alias ..='cd ..'

alias grep='grep --color=auto'
alias diff='diff --color=auto'

alias less='less -R --tabs={{ .env.tabs }}'
alias more='less'

alias mtar='tar --exclude="*.DS_Store" --no-acls --no-fflags --no-xattr --no-mac-metadata'

alias gr="grep -r"

{{ if lookPath "git" }}
alias g='git'

function git_submodule_remove() {
	git config -f .git/config --remove-section submodule."$1"
	git config -f .gitmodules --remove-section submodule."$1"
	git rm --cached "$1"
	git commit -m "Remove $1 cookbook submodule"
	rm -rf "$1"
	rm -rf .git/modules/"$1"
}
{{ end -}}

{{ if lookPath "direnv" }}
# wrap tmux to avoid issues with environment loading
alias tmux='direnv exec / tmux'
{{ end -}}

{{ if lookPath "oauth2l" }}
# configure gcurl alias
alias gcurl='curl -H "$(oauth2l header --json ~/credentials.json cloud-platform userinfo.email)" -H "Content-Type: application/json" '
{{ end -}}

alias path='echo -e ${PATH//:/\\n}'

{{ if eq .chezmoi.os "darwin" }}
#Â cleanup .DS_Store files
alias cleanup='find . -type f \( -name \*.DS_Store -o -name \*._ \) -ls -delete'
{{ end -}}

# remove executable
alias removex='find . -type f -exec chmod a-x "{}" \;'

alias ctags_check='ctags --options={{ (joinPath .chezmoi.homeDir ".local/share/chezmoi/dot_ctags") | quote }}'

{{- if lookPath "timg" }}
alias preview='timg -p k'
alias pv=preview
{{- end }}

{{- if eq .chezmoi.os "darwin" }}
	{{- if stat (joinPath .chezmoi.homeDir "Applications/mpv.app/Contents/MacOS/") | quote }}
alias mpv='{{ (joinPath .chezmoi.homeDir "Applications/mpv.app/Contents/MacOS/mpv") }} --terminal=no --mute=no'
	{{- end }}
	{{- else if eq .chezmoi.os "linux"}}
alias mpv='mpv --terminal=no --mute=no'
{{- end }}

{{- if lookPath "ansible-lint" }}
alias ansible-lint='ansible-lint -c ~/.ansible-lint'
{{- end }}

{{- if lookPath "lazygit" }}
alias lg='lazygit'
{{- end }}

{{- if lookPath "terraform" }}
alias tf='terraform'
{{- end }}

{{- if lookPath "terraform-docs" }}
alias tfd='terraform-docs markdown table --output-file README.md --output-mode inject .'
{{- end }}

{{ if lookPath "limactl" }}
# lima-vm to support genuine docker
function docker() {
	{{- if eq .chezmoi.arch "arm64" }}
	if [[ $ARCH == "amd64" ]]; then
		limactl shell docker-amd64 docker $@
	else
		limactl shell docker-arm64 docker $@
	fi
	{{- else }}
		{{- if eq .chezmoi.arch "amd64" }}
	limactl shell docker-amd64 docker $@
		{{- end }}
	{{- end }}
}
function docker_stop_all() {
	docker stop $(docker ps -a -q)
}
function docker_rm_all() {
	docker rm -f $(docker ps -a -q)
}
function docker_rmi_all() {
	docker rmi -f $(docker images --no-trunc=false -a -q)
}

# lima-vm to support genuine podman
function podman() {
	{{- if eq .chezmoi.arch "arm64" }}
	if [[ $ARCH == "amd64" ]]; then
		limactl shell podman-amd64 podman $@
	else
		limactl shell podman-arm64 podman $@
	fi
	{{- else }}
		{{- if eq .chezmoi.arch "amd64" }}
	limactl shell podman-amd64 podman $@
		{{- end }}
	{{- end }}
}
function podman_stop_all() {
	podman stop $(podman ps -a -q)
}
function podman_rm_all() {
	podman rm -f $(podman ps -a -q)
}
function podman_rmi_all() {
	podman rmi -f $(podman images --no-trunc=false -a -q)
}
{{- end }}

# alias space2tabs='sed -ie 's/{{ repeat (int .env.tabs) " " }}/\t/g'' # bash have issues. TODO: research
