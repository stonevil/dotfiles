{{- /*
vim:ft=bash.gotexttmpl
*/ -}}

HISTFILE={{ (joinPath .chezmoi.homeDir ".zsh_history") | quote }}
HISTSIZE=10000
SAVEHIST=$HISTSIZE
HISTDUP=erase

setopt inc_append_history share_history hist_ignore_dups hist_ignore_all_dups hist_ignore_space hist_find_no_dups hist_verify extended_glob nomatch interactive_comments
unsetopt beep list_beep

ZSH_AUTOSUGGEST_STRATEGY=(history completion)

autoload -Uz colors && colors

autoload -Uz compinit && compinit
zstyle ':completion:*' menu select
# auto complete with case insenstivity
zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

zmodload zsh/complist && compinit
_comp_options+=(globdots)

zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;34=0=01'
zstyle ':completion:*:*:*:*:processes' command "ps -u `whoami` -o pid,user,comm -w -w"
zstyle -e ':completion:*:(ssh|scp|sftp|rsh|rsync):hosts' hosts 'reply=(${=${${(f)"$(cat {/etc/ssh_,~/.ssh/known_}hosts(|2)(N) /dev/null)"}%%[# ]*}//,/ })'

# VI mode
bindkey -v

# allow ctrl-v to edit the command line
autoload -Uz edit-command-line
zle -N edit-command-line
bindkey '^v' edit-command-line
bindkey -M vicmd "^v" edit-command-line

# allow ctrl-p, ctrl-n for navigate history (standard behaviour)
bindkey '^p' up-history
bindkey '^n' down-history

# allow ctrl-h, ctrl-w, ctrl-? for char and word deletion (standard behaviour)
bindkey '^?' backward-delete-char
bindkey '^h' backward-delete-char
bindkey '^w' backward-kill-word

# allow ctrl-r and ctrl-s to search the history
bindkey '^r' history-incremental-search-backward
bindkey '^s' history-incremental-search-forward

# allow ctrl-a and ctrl-e to move to beginning/end of line
bindkey '^a' beginning-of-line
bindkey '^e' end-of-line

# exapand history reference when command starts with ! (or ^)
bindkey " " magic-space

# ci", ci', ci`, di", etc
autoload -U select-quoted
zle -N select-quoted
for m in visual viopp; do
	for c in {a,i}{\',\",\`}; do
		bindkey -M $m $c select-quoted
	done
done

# ci{, ci(, ci<, di{, etc
autoload -U select-bracketed
zle -N select-bracketed
for m in visual viopp; do
	for c in {a,i}${(s..)^:-'()[]{}<>bB'}; do
		bindkey -M $m $c select-bracketed
	done
done

# Just type the filename to open it with the associated program
alias -s json=jless
alias -s md=bat
alias -s go='$EDITOR'
alias -s tmpl='$EDITOR'
alias -s rs='$EDITOR'
alias -s txt=bat
alias -s log=bat
alias -s py='$EDITOR'
alias -s js='$EDITOR'
alias -s ts='$EDITOR'
alias -s mmd='$EDITOR'

{{- if eq .chezmoi.os "darwin" }}
alias -s html=open # macOS: open in default browser
{{ else }}
alias open=xdg-open
alias -s html=xdg-open # Linux: open in default browser
{{- end }}

alias -g NE='2>/dev/null' # Redirect stderr to /dev/null
alias -g NO='>/dev/null' # Redirect stdout to /dev/null
alias -g NUL='>/dev/null 2>&1' # Redirect both stdout and stderr to /dev/null

alias -g J='| jq' # Pipe to jq
alias -g B='| bat' # Pipe to bat
alias -g M='| less' # Pipe to less
alias -g G='| grep' # Pipe to grep

{{- if eq .chezmoi.os "darwin" }}
alias -g C='| pbcopy' # Copy output to clipboard (macOS)
{{ else }}
 alias -g C='| wl-copy' # Copy output to clipboard (Wayland/Linux)
{{- end }}

# Enable zmv
autoload -Uz zmv
# Usage examples:
# zmv '(*).log' '$1.txt'		# Rename .log to .txt
# zmv -w '*.log' '*.txt'		# Same thing, simpler syntax
# zmv -n '(*).log' '$1.txt'	# Dry run (preview changes)
# zmv -i '(*).log' '$1.txt'	# Interactive mode (confirm each)

# cd ~cm
hash -d cm={{ joinPath .chezmoi.homeDir ".local/share/chezmoi" }}
